<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalBridge | Premium Warranty & Commerce</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600&family=Patrick+Hand&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>


    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            blue: '#2563eb',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Plus Jakarta Sans', 'sans-serif'],
                        handwriting: ['Patrick Hand', 'cursive'],
                    },
                    animation: {
                        'float-slow': 'float 6s ease-in-out infinite',
                        'float-delayed': 'float 6s ease-in-out 3s infinite',
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0) rotate(-6deg)' },
                            '50%': { transform: 'translateY(-20px) rotate(-3deg)' },
                        },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                }
            }
        }
    </script>


    <style>
        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: #f8fafc;
            color: #0f172a;
            -webkit-overflow-scrolling: touch;

            -ms-overflow-style: none;

            scrollbar-width: none;

        }

        /* Auth Screen Styles */
        #auth-screen {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f1f5f9;
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1), transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #auth-screen.auth-hidden {
            opacity: 0;
            pointer-events: none;
            transform: scale(1.05);
        }

        .auth-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 2.5rem;
            padding: 3.5rem 3rem;
            width: 100%;
            max-width: 460px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08),
                0 0 1px 0 rgba(0, 0, 0, 0.1);
        }

        .auth-role-btn {
            flex: 1;
            padding: 1.25rem;
            border-radius: 1.25rem;
            border: 1px solid #e2e8f0;
            background: #f8fafc;
            color: #64748b;
            font-weight: 600;
            font-size: 0.813rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }

        .auth-role-btn:hover {
            border-color: #cbd5e1;
            background: #f1f5f9;
            color: #334155;
        }

        .auth-role-btn.selected {
            border-color: #2563eb;
            background: rgba(37, 99, 235, 0.05);
            color: #2563eb;
            box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.1);
            transform: translateY(-2px);
        }

        .auth-role-btn i {
            font-size: 1.5rem;
        }

        .auth-input {
            width: 100%;
            padding: 1rem 1.25rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            color: #0f172a;
            font-size: 0.938rem;
            outline: none;
            transition: all 0.3s;
        }

        .auth-input::placeholder {
            color: #94a3b8;
        }

        .auth-input:focus {
            border-color: #94a3b8;
            background: white;
            box-shadow: 0 0 0 4px rgba(148, 163, 184, 0.1);
        }

        .auth-submit-btn {
            width: 100%;
            padding: 1rem;
            border-radius: 1rem;
            background: #2563eb;
            color: white;
            font-weight: 700;
            font-size: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.3);
        }

        .auth-submit-btn:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 15px 30px -10px rgba(37, 99, 235, 0.4);
        }

        .auth-submit-btn:active {
            transform: scale(0.98);
        }

        .auth-toggle-link {
            color: #60a5fa;
            cursor: pointer;
            font-weight: 600;
            transition: color 0.2s;
        }

        .auth-toggle-link:hover {
            color: #93bbfc;
            text-decoration: underline;
        }

        @keyframes auth-float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .auth-float-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
            animation: auth-float 8s ease-in-out infinite;
            pointer-events: none;
        }


        .dark body {
            background-color: #020617;
            color: #f8fafc;
        }


        .reveal {
            filter: blur(12px);
            transition: filter 1.2s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: filter;
        }

        .reveal.revealed {
            filter: blur(0);
        }


        .reveal-children>* {
            filter: blur(8px);
            transition: filter 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .reveal-children.revealed>*:nth-child(1) {
            transition-delay: 0.05s;
        }

        .reveal-children.revealed>*:nth-child(2) {
            transition-delay: 0.1s;
        }

        .reveal-children.revealed>*:nth-child(3) {
            transition-delay: 0.15s;
        }

        .reveal-children.revealed>*:nth-child(4) {
            transition-delay: 0.2s;
        }

        .reveal-children.revealed>*:nth-child(5) {
            transition-delay: 0.25s;
        }

        .reveal-children.revealed>*:nth-child(6) {
            transition-delay: 0.3s;
        }

        .reveal-children.revealed>* {
            filter: blur(0);
        }


        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }


        .btn-liquid {
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn-liquid span {
            position: relative;
            z-index: 2;
        }

        .btn-liquid::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1e40af;

            border-radius: 0.75rem;
            z-index: -1;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            transform: scaleY(0);
            transform-origin: bottom;
        }

        .btn-liquid:hover::after {
            transform: scaleY(1);
        }

        .btn-liquid::before {
            content: '';
            position: absolute;
            bottom: -50%;
            left: -25%;
            width: 150%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 40%;
            animation: liquid-wave 6s linear infinite;
            z-index: -1;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .btn-liquid:hover::before {
            opacity: 1;
        }

        @keyframes liquid-wave {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            pointer-events: none;
        }

        .toast {
            background: white;
            color: #0f172a;
            padding: 1rem 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            min-width: 300px;
            pointer-events: auto;
            animation: toast-in 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            border-left: 4px solid #2563eb;
        }

        .toast.success {
            border-left-color: #10b981;
        }

        .toast.error {
            border-left-color: #ef4444;
        }

        .toast.info {
            border-left-color: #3b82f6;
        }

        @keyframes toast-in {
            from {
                opacity: 0;
                transform: translateY(1rem) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes toast-out {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            to {
                opacity: 0;
                transform: translateY(1rem) scale(0.9);
            }
        }
    </style>
</head>

<body class="antialiased selection:bg-blue-100 selection:text-blue-900 transition-colors duration-300 relative">

    <!-- AUTH SCREEN OVERLAY -->
    <div id="auth-screen">
        <div class="auth-card">
            <!-- Integrated Login & Role Selection -->
            <div id="auth-step-form">
                <!-- Role Selection Toggle (Integrated) -->
                <div class="flex gap-3 mb-6">
                    <button class="auth-role-btn selected" onclick="selectAuthRole('merchant')" id="auth-role-merchant">
                        <i class="fas fa-store"></i>
                        <span class="text-[11px]">Merchant</span>
                    </button>
                    <button class="auth-role-btn" onclick="selectAuthRole('customer')" id="auth-role-customer">
                        <i class="fas fa-user"></i>
                        <span class="text-[11px]">Customer</span>
                    </button>
                </div>

                <div class="flex items-center gap-2 mb-4 opacity-70">
                    <span id="auth-role-icon" class="text-slate-400"><i class="fas fa-store"></i></span>
                    <span id="auth-role-label"
                        class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Merchant Portal</span>
                </div>

                <h2 class="text-lg font-bold text-slate-900 mb-1" id="auth-form-title"
                    style="font-family:'Plus Jakarta Sans',sans-serif;">Login to your account</h2>
                <p class="text-xs text-slate-500 mb-6" id="auth-form-desc">Enter your details to continue</p>

                <form onsubmit="handleAuthSubmit(event)" class="space-y-4">
                    <div id="auth-name-field" class="hidden">
                        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Full
                            Name</label>
                        <input type="text" id="auth-name" class="auth-input" placeholder="e.g. Rahul Sharma">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Email
                            or Phone Number</label>
                        <input type="text" id="auth-email" class="auth-input"
                            placeholder="e.g. rahul@email.com or 98765 43210" required>
                    </div>
                    <div>
                        <label
                            class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Password</label>
                        <input type="password" id="auth-password" class="auth-input" placeholder="Enter your password"
                            required>
                    </div>
                    <div class="flex justify-end pt-1" id="auth-forgot-link-container">
                        <span class="text-[11px] font-semibold text-blue-600 hover:underline cursor-pointer"
                            onclick="toggleForgotMode(true)">Forgot Password?</span>
                    </div>
                    <button type="submit" class="auth-submit-btn" id="auth-submit-btn">
                        Login
                    </button>
                </form>

                <p class="text-center text-xs text-slate-500 mt-5">
                    <span id="auth-toggle-text">Don't have an account?</span>
                    <span class="text-blue-600 font-semibold cursor-pointer hover:underline ml-1"
                        onclick="toggleAuthMode()" id="auth-toggle-btn">Sign Up</span>
                </p>
            </div>

            <!-- Email Verification View -->
            <div id="auth-verification-view" class="hidden py-8 text-center animate-fade-in">
                <div
                    class="w-20 h-20 bg-blue-50 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-envelope-open-text text-3xl text-brand-blue"></i>
                </div>
                <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-3">Verify your email</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-8 leading-relaxed">
                    We have sent you a verification email to <span id="verification-email-display"
                        class="font-bold text-slate-800 dark:text-slate-200"></span>. Please verify it and log in.
                </p>
                <button onclick="window.location.reload()" class="auth-submit-btn py-3 px-8">
                    Back to Login
                </button>
            </div>

            <!-- Forgot Password View -->
            <div id="auth-forgot-view" class="hidden py-4 animate-fade-in">
                <div class="flex items-center gap-2 mb-6 cursor-pointer text-slate-400 hover:text-slate-600 transition-colors"
                    onclick="toggleForgotMode(false)">
                    <i class="fas fa-arrow-left text-xs"></i>
                    <span class="text-[10px] font-bold uppercase tracking-widest">Back to Login</span>
                </div>

                <h2 class="text-xl font-bold text-slate-900 mb-1">Reset Password</h2>
                <p class="text-xs text-slate-500 mb-8">Enter your email and we'll send you a reset link.</p>

                <form onsubmit="handleForgotPasswordSubmit(event)" class="space-y-6">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Email
                            Address</label>
                        <input type="email" id="auth-forgot-email" class="auth-input" placeholder="e.g. rahul@email.com"
                            required>
                    </div>

                    <button type="submit" class="auth-submit-btn" id="auth-forgot-submit-btn">
                        Send Reset Link
                    </button>
                </form>

                <div id="forgot-success-msg"
                    class="hidden mt-6 p-4 bg-green-50 border border-green-100 rounded-2xl text-center animate-fade-in">
                    <i class="fas fa-check-circle text-green-500 mb-2 text-xl"></i>
                    <p class="text-[11px] font-bold text-green-800 uppercase tracking-tight">Email Sent!</p>
                    <p class="text-[10px] text-green-600 mt-1">Check your inbox for the reset link.</p>
                </div>
            </div>
        </div>
    </div>



    <nav id="main-nav" class="hidden fixed w-full z-50 bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-xl bg-brand-blue flex items-center justify-center text-white shadow-lg shadow-blue-500/30">
                    <i class="fas fa-cube text-lg"></i>
                </div>
                <span
                    class="hidden sm:inline font-display font-bold text-xl tracking-tight text-slate-900 dark:text-white">Local<span
                        class="text-brand-blue">Bridge</span></span>
            </div>


            <div id="nav-role-toggle"
                class="bg-slate-100 dark:bg-slate-800 p-1 rounded-full flex items-center shadow-inner relative">
                <button onclick="switchView('customer')" id="btn-customer"
                    class="px-3 md:px-6 py-2 rounded-full text-xs md:text-sm font-semibold transition-all duration-300 bg-white dark:bg-slate-700 text-brand-blue shadow-sm">
                    Customer
                </button>
                <button onclick="switchView('merchant')" id="btn-merchant"
                    class="px-3 md:px-6 py-2 rounded-full text-xs md:text-sm font-semibold text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-all duration-300">
                    Merchant
                </button>
            </div>
            <!-- Role Badge (shown after login) -->
            <div id="nav-role-badge"
                class="hidden px-4 py-2 rounded-full text-xs md:text-sm font-bold bg-blue-50 dark:bg-blue-900/30 text-brand-blue border border-blue-100 dark:border-blue-800/50">
                <i class="fas fa-user mr-1" id="nav-badge-icon"></i>
                <span id="nav-badge-text">Customer</span>
            </div>


            <div class="flex items-center gap-4">
                <button onclick="toggleDarkMode()"
                    class="w-10 h-10 rounded-full bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center justify-center text-slate-600 dark:text-slate-300 transition">
                    <i class="fas fa-moon" id="dark-icon"></i>
                </button>


                <div class="relative">
                    <button onclick="toggleNotifications()"
                        class="w-10 h-10 rounded-full bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center justify-center text-slate-600 dark:text-slate-300 transition">
                        <i class="far fa-bell"></i>
                        <span
                            class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white dark:border-slate-800"></span>
                    </button>

                    <div id="notif-dropdown"
                        class="hidden absolute right-0 mt-4 w-80 bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 overflow-hidden transform origin-top-right transition-all">
                        <div
                            class="p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                            <h4 class="font-bold text-sm dark:text-white">Latest Updates</h4>
                            <span class="text-xs text-brand-blue font-semibold cursor-pointer">Mark all read</span>
                        </div>
                        <div class="max-h-64 overflow-y-auto">
                            <div
                                class="p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 cursor-pointer border-b border-slate-50 dark:border-slate-700/50">
                                <div class="flex gap-3">
                                    <div
                                        class="w-8 h-8 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-exclamation"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-semibold text-slate-900 dark:text-slate-100">Warranty
                                            Expiring</p>
                                        <p class="text-xs text-slate-500 dark:text-slate-400">Your Nike Air Jordan
                                            warranty ends in 14 days.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 cursor-pointer">
                                <div class="flex gap-3">
                                    <div
                                        class="w-8 h-8 rounded-full bg-blue-100 text-brand-blue flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-tag"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-semibold text-slate-900 dark:text-slate-100">Offer from
                                            Verma Fashion</p>
                                        <p class="text-xs text-slate-500 dark:text-slate-400">"New winter collection is
                                            here! 20% off for you."</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="relative">
                    <div onclick="toggleProfileDropdown()"
                        class="hidden md:flex w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-indigo-600 p-[2px] shadow-md cursor-pointer items-center justify-center overflow-hidden group hover:ring-2 hover:ring-brand-blue/50 transition-all">
                        <div id="nav-avatar-initials"
                            class="hidden w-full h-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-sm font-bold text-slate-700 dark:text-slate-200">
                            HG
                        </div>
                        <img id="nav-avatar-img" src="https://ui-avatars.com/api/?name=H+G&background=random"
                            class="rounded-full w-full h-full object-cover">
                    </div>

                    <!-- Profile Dropdown Menu -->
                    <div id="profile-dropdown"
                        class="hidden absolute right-0 mt-4 w-72 bg-white dark:bg-slate-800 rounded-[2rem] shadow-2xl border border-slate-100 dark:border-slate-700 overflow-hidden transform origin-top-right transition-all z-[60]">
                        <div class="p-6 border-b border-slate-100 dark:border-slate-700/50">
                            <div class="flex items-center gap-4 mb-4">
                                <div
                                    class="w-12 h-12 rounded-full p-[2px] bg-gradient-to-br from-blue-400 to-indigo-600">
                                    <div class="w-full h-full rounded-full overflow-hidden bg-white">
                                        <img id="dropdown-avatar-img"
                                            src="https://ui-avatars.com/api/?name=H+G&background=random"
                                            class="w-full h-full object-cover">
                                    </div>
                                </div>
                                <div class="overflow-hidden">
                                    <p class="font-bold text-slate-900 dark:text-white truncate"
                                        id="dropdown-user-name">Harsh Gupta</p>
                                    <p class="text-xs text-slate-500 dark:text-slate-400 truncate"
                                        id="dropdown-user-email">harsh@localbridge.com</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="p-2 rounded-xl bg-blue-50 dark:bg-blue-900/20 text-center">
                                    <p class="text-[10px] uppercase font-bold text-blue-600 dark:text-blue-400">Status
                                    </p>
                                    <p class="text-xs font-bold text-slate-800 dark:text-slate-200">Pro Plan</p>
                                </div>
                                <div class="p-2 rounded-xl bg-indigo-50 dark:bg-indigo-900/20 text-center">
                                    <p class="text-[10px] uppercase font-bold text-indigo-600 dark:text-indigo-400">
                                        Score</p>
                                    <p class="text-xs font-bold text-slate-800 dark:text-slate-200">98%</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-2">
                            <button onclick="switchView('profile'); toggleProfileDropdown()"
                                class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                                <i class="fas fa-user-circle text-brand-blue"></i>
                                View Profile Settings
                            </button>
                            <button
                                class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                                <i class="fas fa-shield-alt text-brand-blue"></i>
                                Security & Privacy
                            </button>
                            <div class="h-px bg-slate-100 dark:bg-slate-700/50 my-2 mx-4"></div>
                            <button onclick="authSignOut()"
                                class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition">
                                <i class="fas fa-sign-out-alt"></i>
                                Sign Out
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </nav>


    <div id="customer-view" class="hidden pt-28 px-6 min-h-screen fade-in">
        <div class="max-w-7xl mx-auto">


            <section class="max-w-7xl mx-auto px-6 py-16 md:py-24 lg:py-32 relative">

                <div
                    class="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl opacity-50 pointer-events-none">
                </div>
                <div
                    class="absolute bottom-0 left-0 -ml-20 -mb-20 w-72 h-72 bg-indigo-500/10 rounded-full blur-3xl opacity-50 pointer-events-none">
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">


                    <div class="relative z-10 text-center lg:text-left">


                        <h1
                            class="font-display font-extrabold text-5xl md:text-6xl lg:text-7xl text-slate-900 dark:text-white leading-[1.1] mb-6 tracking-tight">
                            Stop Guessing.<br>
                            <span
                                class="text-transparent bg-clip-text bg-gradient-to-r from-brand-blue to-indigo-600">Start
                                Growing.</span>
                        </h1>

                        <p
                            class="text-lg text-slate-600 dark:text-slate-300 mb-8 leading-relaxed max-w-lg mx-auto lg:mx-0 font-medium">
                            Manage inventory, sales, and analytics in one powerful platform. The smart operating system
                            for modern retail businesses.
                        </p>

                        <ul class="space-y-3 mb-8 text-left max-w-md mx-auto lg:mx-0">
                            <li class="flex items-center gap-3">
                                <div
                                    class="flex-shrink-0 w-6 h-6 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xs">
                                    <i class="fas fa-check"></i>
                                </div>
                                <span class="text-slate-700 dark:text-slate-200 font-medium">Real-time inventory
                                    tracking</span>
                            </li>
                            <li class="flex items-center gap-3">
                                <div
                                    class="flex-shrink-0 w-6 h-6 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xs">
                                    <i class="fas fa-check"></i>
                                </div>
                                <span class="text-slate-700 dark:text-slate-200 font-medium">Smart sales analytics &
                                    reports</span>
                            </li>
                            <li class="flex items-center gap-3">
                                <div
                                    class="flex-shrink-0 w-6 h-6 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xs">
                                    <i class="fas fa-check"></i>
                                </div>
                                <span class="text-slate-700 dark:text-slate-200 font-medium">AI stock
                                    optimization</span>
                            </li>
                        </ul>

                        <div class="flex flex-col sm:flex-row items-center gap-4 justify-center lg:justify-start mb-10">
                            <button
                                class="btn-liquid w-full sm:w-auto px-8 py-4 bg-brand-blue text-white rounded-xl font-bold text-lg transition-all shadow-[0_4px_14px_0_rgba(37,99,235,0.39)] hover:shadow-[0_6px_20px_rgba(37,99,235,0.23)] hover:-translate-y-0.5">
                                <span>Get Started</span>
                            </button>
                            <button
                                class="w-full sm:w-auto px-8 py-4 text-slate-600 dark:text-slate-300 font-bold text-lg hover:text-brand-blue transition flex items-center justify-center gap-2 group">
                                <div
                                    class="w-10 h-10 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex items-center justify-center group-hover:border-brand-blue group-hover:scale-110 transition-all shadow-sm">
                                    <i class="fas fa-play text-brand-blue text-xs ml-0.5"></i>
                                </div>
                                See How It Works
                            </button>
                        </div>


                        <div
                            class="flex items-center justify-center lg:justify-start gap-4 opacity-80 hover:opacity-100 transition-opacity">
                            <div class="flex -space-x-3">
                                <img src="https://images.unsplash.com/photo-1542909168-82c3e7fdca5c?auto=format&fit=crop&w=64&h=64"
                                    class="w-10 h-10 rounded-full border-2 border-white dark:border-slate-900"
                                    alt="User">
                                <img src="https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=64&h=64"
                                    class="w-10 h-10 rounded-full border-2 border-white dark:border-slate-900"
                                    alt="User">
                                <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=64&h=64"
                                    class="w-10 h-10 rounded-full border-2 border-white dark:border-slate-900"
                                    alt="User">
                                <div
                                    class="w-10 h-10 rounded-full border-2 border-white dark:border-slate-900 bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-xs font-bold text-slate-600 dark:text-slate-300">
                                    +2k</div>
                            </div>
                            <div class="text-sm">
                                <div class="flex text-yellow-400 text-xs mb-0.5">
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                        class="fas fa-star"></i><i class="fas fa-star"></i>
                                </div>
                                <span class="font-medium text-slate-600 dark:text-slate-400">Trusted by <strong
                                        class="text-slate-900 dark:text-white">2,000+ stores</strong></span>
                            </div>
                        </div>
                    </div>


                    <div class="relative perspective-1000 group mt-10 lg:mt-0">

                        <div
                            class="relative bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 p-2 transform rotate-y-[-5deg] rotate-x-[2deg] transition-transform duration-500 hover:rotate-0 hover:scale-[1.02]">

                            <div
                                class="bg-slate-50 dark:bg-slate-900 rounded-t-xl py-2 px-4 flex items-center gap-2 border-b border-slate-100 dark:border-slate-700/50">
                                <div class="flex gap-1.5">
                                    <div class="w-2.5 h-2.5 rounded-full bg-red-400"></div>
                                    <div class="w-2.5 h-2.5 rounded-full bg-yellow-400"></div>
                                    <div class="w-2.5 h-2.5 rounded-full bg-green-400"></div>
                                </div>
                                <div class="flex-1 text-center">
                                    <div class="bg-white dark:bg-slate-800 rounded-md h-5 w-2/3 mx-auto shadow-sm">
                                    </div>
                                </div>
                            </div>


                            <div
                                class="p-6 bg-slate-50/50 dark:bg-slate-900/50 min-h-[300px] rounded-b-xl relative overflow-hidden">

                                <div class="grid grid-cols-3 gap-4 mb-6">
                                    <div class="bg-white dark:bg-slate-800 p-3 rounded-lg shadow-sm">
                                        <div class="text-xs text-slate-400 font-bold uppercase mb-1">Revenue</div>
                                        <div class="font-bold text-lg text-slate-900 dark:text-white">â‚¹45.2k</div>
                                        <div class="text-[10px] text-green-500 font-bold">â†‘ 12%</div>
                                    </div>
                                    <div class="bg-white dark:bg-slate-800 p-3 rounded-lg shadow-sm">
                                        <div class="text-xs text-slate-400 font-bold uppercase mb-1">Orders</div>
                                        <div class="font-bold text-lg text-slate-900 dark:text-white">1,204</div>
                                        <div class="text-[10px] text-green-500 font-bold">â†‘ 5%</div>
                                    </div>
                                    <div class="bg-white dark:bg-slate-800 p-3 rounded-lg shadow-sm">
                                        <div class="text-xs text-slate-400 font-bold uppercase mb-1">Customers</div>
                                        <div class="font-bold text-lg text-slate-900 dark:text-white">892</div>
                                        <div class="text-[10px] text-slate-400 font-bold">+24 new</div>
                                    </div>
                                </div>


                                <div
                                    class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm mb-4 border border-slate-100 dark:border-slate-700">
                                    <div class="flex justify-between items-center mb-4">
                                        <h4 class="font-bold text-sm text-slate-700 dark:text-slate-200">Sales Overview
                                        </h4>
                                        <div
                                            class="bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-xs font-semibold text-slate-500">
                                            Weekly</div>
                                    </div>
                                    <div class="flex items-end justify-between h-24 gap-2">
                                        <div class="w-full bg-blue-100 dark:bg-blue-900/30 rounded-t h-[40%]"></div>
                                        <div class="w-full bg-blue-100 dark:bg-blue-900/30 rounded-t h-[60%]"></div>
                                        <div class="w-full bg-blue-200 dark:bg-blue-800/50 rounded-t h-[50%]"></div>
                                        <div
                                            class="w-full bg-brand-blue rounded-t h-[85%] relative group-hover:h-[95%] transition-all duration-500">
                                            <div
                                                class="absolute -top-6 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[10px] px-1.5 py-0.5 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                                                â‚¹12k</div>
                                        </div>
                                        <div class="w-full bg-blue-100 dark:bg-blue-900/30 rounded-t h-[65%]"></div>
                                        <div class="w-full bg-blue-100 dark:bg-blue-900/30 rounded-t h-[75%]"></div>
                                        <div class="w-full bg-blue-100 dark:bg-blue-900/30 rounded-t h-[55%]"></div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div
                            class="absolute -top-4 -right-4 bg-white dark:bg-slate-800 p-3 rounded-xl shadow-lg border-l-4 border-red-500 animate-float-slow z-20 max-w-[150px]">
                            <div class="flex items-start gap-3">
                                <div
                                    class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-500 flex-shrink-0">
                                    <i class="fas fa-exclamation-triangle text-xs"></i>
                                </div>
                                <div>
                                    <div class="text-xs font-bold text-slate-800 dark:text-white">Low Stock</div>
                                    <div class="text-[10px] text-slate-500">Reorder Nike Air</div>
                                </div>
                            </div>
                        </div>


                        <div
                            class="absolute -bottom-6 -left-6 bg-white dark:bg-slate-800 p-3 rounded-xl shadow-lg border-l-4 border-green-500 animate-float-delayed z-20">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600">
                                    <i class="fas fa-arrow-trend-up text-xs"></i>
                                </div>
                                <div>
                                    <div class="text-xs font-bold text-slate-800 dark:text-white">Sales Goal Met!</div>
                                    <div class="text-[10px] text-green-500">Congratulations ðŸŽ‰</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>



            <!-- GLOBAL OFFERS SECTION (NEW) -->
            <section class="mb-20 reveal hidden" id="customer-offers-section">
                <div class="flex items-end justify-between mb-8">
                    <div>
                        <h2 class="font-display font-bold text-3xl text-slate-900 dark:text-white">Offers from Shops
                            Near You</h2>
                        <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">Exclusive promotions from local
                            businesses</p>
                    </div>
                </div>
                <div id="customer-offers-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Dynamic Offer Cards will be injected here -->
                </div>
            </section>

            <section class="mb-20 reveal">
                <div
                    class="bg-white dark:bg-slate-800 rounded-[2rem] p-8 md:p-12 border border-slate-100 dark:border-slate-700 shadow-xl relative overflow-hidden group">

                    <div
                        class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/3 group-hover:bg-blue-500/20 transition duration-700">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center relative z-10">
                        <div>
                            <div
                                class="inline-flex items-center gap-2 px-3 py-1 bg-blue-50 dark:bg-blue-900/30 text-brand-blue text-xs font-bold uppercase tracking-wider rounded-full mb-4">
                                <i class="fas fa-magic"></i> AI Powered
                            </div>
                            <h2 class="font-display font-bold text-3xl md:text-4xl text-slate-900 dark:text-white mb-4">
                                Smart Receipt Scanner</h2>
                            <p class="text-slate-500 dark:text-slate-400 mb-8 max-w-md">Instantly digitize your paper
                                receipts. Our AI automatically extracts product details, warranty dates, and merchant
                                info
                                with <span class="text-brand-blue font-bold">98% accuracy</span>.</p>

                            <ul class="space-y-4 mb-8">
                                <li class="flex items-center gap-3 text-slate-600 dark:text-slate-300">
                                    <div
                                        class="w-6 h-6 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xs">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <span class="text-sm font-medium">Auto-calculate warranty expiry</span>
                                </li>
                                <li class="flex items-center gap-3 text-slate-600 dark:text-slate-300">
                                    <div
                                        class="w-6 h-6 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xs">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <span class="text-sm font-medium">Categorize spending automatically</span>
                                </li>
                                <li class="flex items-center gap-3 text-slate-600 dark:text-slate-300">
                                    <div
                                        class="w-6 h-6 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xs">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <span class="text-sm font-medium">Never lose a bill again</span>
                                </li>
                            </ul>
                        </div>


                        <div>
                            <div id="drop-zone"
                                class="border-3 border-dashed border-slate-200 dark:border-slate-600 rounded-[2rem] bg-slate-50 dark:bg-slate-900/50 p-8 text-center transition-all duration-300 hover:border-brand-blue hover:bg-blue-50/50 dark:hover:bg-blue-900/10 cursor-pointer relative"
                                ondragover="event.preventDefault(); this.classList.add('border-brand-blue', 'bg-blue-50')"
                                ondragleave="this.classList.remove('border-brand-blue', 'bg-blue-50')"
                                ondrop="handleDrop(event)" onclick="document.getElementById('file-upload').click()">

                                <input type="file" id="file-upload" class="hidden" onchange="handleFileSelect(event)">

                                <div id="scan-idle">
                                    <div
                                        class="w-20 h-20 bg-white dark:bg-slate-800 rounded-full shadow-lg mx-auto flex items-center justify-center mb-6 text-brand-blue text-3xl">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                    </div>
                                    <h3 class="font-bold text-lg text-slate-900 dark:text-white mb-2">Click to Upload or
                                        Drag Receipt</h3>
                                    <p class="text-sm text-slate-400">Supports JPG, PNG, PDF (Max 5MB)</p>
                                </div>

                                <div id="scan-processing" class="hidden">
                                    <div class="w-20 h-20 mx-auto mb-6 relative">
                                        <div
                                            class="absolute inset-0 border-4 border-slate-100 dark:border-slate-700 rounded-full">
                                        </div>
                                        <div
                                            class="absolute inset-0 border-4 border-brand-blue rounded-full border-t-transparent animate-spin">
                                        </div>
                                        <div
                                            class="absolute inset-0 flex items-center justify-center text-brand-blue font-bold text-xs animate-pulse">
                                            AI</div>
                                    </div>
                                    <h3 class="font-bold text-lg text-slate-900 dark:text-white mb-2">Analyzing
                                        Receipt...
                                    </h3>
                                    <p class="text-sm text-slate-400">Extracting merchant & warranty details</p>
                                </div>

                                <div id="scan-success" class="hidden">
                                    <div
                                        class="w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full shadow-inner mx-auto flex items-center justify-center mb-6 text-green-600 text-3xl">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <h3 class="font-bold text-lg text-slate-900 dark:text-white mb-2">Warranty Added!
                                    </h3>
                                    <p class="text-sm text-slate-400">Sony Headphones â€¢ 1 Year Warranty</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>




            <section class="mb-20 reveal">
                <div class="flex items-end justify-between mb-8">
                    <div>
                        <h2 class="font-display font-bold text-3xl text-slate-900 dark:text-white">Digital Vault</h2>
                        <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">Your active coverages</p>
                    </div>
                    <button class="hidden md:flex items-center gap-2 text-brand-blue font-semibold hover:underline">
                        View Archived <i class="fas fa-arrow-right text-xs"></i>
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <div
                        class="bg-white dark:bg-slate-800 rounded-[2rem] p-8 border border-slate-100 dark:border-slate-700 hover:shadow-xl dark:hover:shadow-slate-900/50 transition-all duration-300 group">
                        <div class="flex justify-between items-start mb-6">
                            <div class="flex items-center gap-4">
                                <div
                                    class="w-12 h-12 rounded-2xl bg-blue-50 dark:bg-slate-700 flex items-center justify-center text-brand-blue text-xl">
                                    <i class="fas fa-tv"></i>
                                </div>
                                <div>
                                    <h3 class="font-display font-bold text-xl text-slate-900 dark:text-white">Samsung
                                        OLED 55"</h3>
                                    <p class="text-sm text-slate-500 dark:text-slate-400 font-medium">Sharma Electronics
                                        <i class="fas fa-check-circle text-blue-500 text-xs ml-1"
                                            title="Verified Merchant"></i>
                                    </p>
                                </div>
                            </div>
                            <span
                                class="px-3 py-1 bg-green-50 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-xs font-bold uppercase tracking-wider rounded-full">Active</span>
                        </div>

                        <div class="mb-6">
                            <div
                                class="flex justify-between text-xs font-semibold text-slate-400 mb-2 uppercase tracking-wide">
                                <span>Expires in 186 Days</span>
                                <span>24% Used</span>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-full h-2 overflow-hidden">
                                <div class="bg-brand-blue h-2 rounded-full progress-bar-fill" style="width: 24%"></div>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="openReceipt('Samsung OLED 55', 'Sharma Electronics')"
                                class="flex-1 py-3 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-semibold text-sm hover:opacity-90 transition shadow-lg shadow-slate-900/20">
                                View Receipt
                            </button>
                            <button
                                class="px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-600 transition">
                                <i class="fas fa-headset"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Nike Card -->
                    <div
                        class="bg-white dark:bg-slate-800 rounded-[2rem] p-8 border border-slate-100 dark:border-slate-700 hover:shadow-xl dark:hover:shadow-slate-900/50 transition-all duration-300 group">
                        <div class="flex justify-between items-start mb-6">
                            <div class="flex items-center gap-4">
                                <div
                                    class="w-12 h-12 rounded-2xl bg-blue-50 dark:bg-slate-700 flex items-center justify-center text-brand-blue text-xl">
                                    <i class="fas fa-shoe-prints"></i>
                                </div>
                                <div>
                                    <h3 class="font-display font-bold text-xl text-slate-900 dark:text-white">Nike Air
                                        Jordan</h3>
                                    <p class="text-sm text-slate-500 dark:text-slate-400 font-medium">Verma Fashion
                                        Store <i class="fas fa-check-circle text-blue-500 text-xs ml-1"
                                            title="Verified Merchant"></i></p>
                                </div>
                            </div>
                            <span
                                class="px-3 py-1 bg-green-50 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-xs font-bold uppercase tracking-wider rounded-full">Active</span>
                        </div>

                        <div class="mb-6">
                            <div
                                class="flex justify-between text-xs font-semibold text-slate-400 mb-2 uppercase tracking-wide">
                                <span>Expires in 14 Days</span>
                                <span>92% Used</span>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-full h-2 overflow-hidden">
                                <div class="bg-brand-blue h-2 rounded-full progress-bar-fill" style="width: 92%"></div>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="openReceipt('Nike Air Jordan', 'Verma Fashion Store')"
                                class="flex-1 py-3 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-semibold text-sm hover:opacity-90 transition shadow-lg shadow-slate-900/20">
                                View Receipt
                            </button>
                            <button
                                class="px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-600 transition">
                                <i class="fas fa-headset"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>


            <section class="mb-20 reveal">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="font-display font-bold text-3xl text-slate-900 dark:text-white">Warranty Assistant</h2>
                    <span
                        class="px-3 py-1 bg-red-50 dark:bg-red-900/30 text-red-600 font-bold text-xs uppercase tracking-wider rounded-full">1
                        Action Needed</span>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                    <div
                        class="lg:col-span-2 bg-gradient-to-br from-red-50 to-white dark:from-red-900/20 dark:to-slate-800 rounded-[2rem] p-8 border border-red-100 dark:border-red-900/50 shadow-sm relative overflow-hidden">
                        <div
                            class="absolute right-0 top-0 w-32 h-32 bg-red-500/10 rounded-full blur-2xl translate-x-1/2 -translate-y-1/2">
                        </div>

                        <div class="flex flex-col md:flex-row gap-6 items-start md:items-center relative z-10">
                            <div
                                class="w-16 h-16 rounded-2xl bg-white dark:bg-slate-700 shadow-md flex items-center justify-center text-red-500 text-2xl flex-shrink-0 animate-pulse">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-xl text-slate-900 dark:text-white mb-2">Claim Nike Warranty
                                    Now
                                </h3>
                                <p class="text-slate-600 dark:text-slate-300 text-sm mb-4">Your <span
                                        class="font-semibold text-slate-900 dark:text-white">Nike Air Jordan</span>
                                    warranty
                                    expires in <span class="font-bold text-red-500">14 days</span>. We found a verified
                                    service center 2.4km away.</p>
                                <div class="flex flex-wrap gap-3">
                                    <button
                                        class="px-6 py-2.5 bg-red-500 hover:bg-red-600 text-white rounded-xl font-bold text-sm shadow-lg shadow-red-500/30 transition">
                                        Start Claim
                                    </button>
                                    <button
                                        class="px-6 py-2.5 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-600 rounded-xl font-bold text-sm hover:bg-slate-50 dark:hover:bg-slate-600 transition flex items-center gap-2">
                                        <i class="fas fa-map-marker-alt"></i> Locate Center
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div
                        class="bg-white dark:bg-slate-800 rounded-[2rem] p-8 border border-slate-100 dark:border-slate-700 shadow-sm">
                        <h3 class="font-bold text-lg text-slate-900 dark:text-white mb-6">Upcoming Expiries</h3>
                        <div class="space-y-6">
                            <div class="flex items-center gap-4">
                                <div
                                    class="w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-500">
                                    <i class="fas fa-plug"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-sm text-slate-900 dark:text-white">Apple Charger</h4>
                                    <p class="text-xs text-slate-400">Expires in 45 days</p>
                                </div>
                                <div
                                    class="w-8 h-8 rounded-full border border-slate-200 dark:border-slate-600 flex items-center justify-center text-slate-400 text-xs">
                                    20%
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div
                                    class="w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-500">
                                    <i class="fas fa-stopwatch"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-sm text-slate-900 dark:text-white">Casio Watch</h4>
                                    <p class="text-xs text-slate-400">Expires in 3 months</p>
                                </div>
                                <div
                                    class="w-8 h-8 rounded-full border border-slate-200 dark:border-slate-600 flex items-center justify-center text-slate-400 text-xs">
                                    65%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>


            <section class="mb-20 reveal">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="font-display font-bold text-3xl text-slate-900 dark:text-white">Smart Savings</h2>
                    <div class="flex gap-2">
                        <select
                            class="text-xs bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1 font-bold text-slate-600 dark:text-slate-300 outline-none">
                            <option>This Month</option>
                            <option>Last 3 Months</option>
                            <option>Yearly</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">

                    <div
                        class="bg-white dark:bg-slate-800 rounded-[2rem] p-6 border border-slate-100 dark:border-slate-700 shadow-sm">
                        <div
                            class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center mb-4">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Total Saved</p>
                        <h3 class="font-display font-bold text-2xl text-slate-900 dark:text-white">â‚¹12,450</h3>
                        <p class="text-[10px] text-green-500 font-bold mt-2"><i class="fas fa-arrow-up"></i> 12% vs last
                            month</p>
                    </div>


                    <div
                        class="bg-white dark:bg-slate-800 rounded-[2rem] p-6 border border-slate-100 dark:border-slate-700 shadow-sm">
                        <div
                            class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mb-4">
                            <i class="fas fa-coins"></i>
                        </div>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Cashback</p>
                        <h3 class="font-display font-bold text-2xl text-slate-900 dark:text-white">â‚¹3,200</h3>
                        <p class="text-[10px] text-slate-400 font-bold mt-2">Available to redeem</p>
                    </div>


                    <div
                        class="bg-white dark:bg-slate-800 rounded-[2rem] p-6 border border-slate-100 dark:border-slate-700 shadow-sm">
                        <div
                            class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center mb-4">
                            <i class="fas fa-tags"></i>
                        </div>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Active Deals</p>
                        <h3 class="font-display font-bold text-2xl text-slate-900 dark:text-white">8 Offers</h3>
                        <p class="text-[10px] text-orange-500 font-bold mt-2">Expiring this week</p>
                    </div>


                    <div
                        class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-[2rem] p-6 shadow-lg shadow-indigo-500/20 text-white relative overflow-hidden group cursor-pointer hover:scale-[1.02] transition-transform">
                        <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <i class="fas fa-chart-pie text-4xl opacity-20 absolute right-4 top-4"></i>
                        <p class="text-xs font-bold text-white/70 uppercase tracking-widest mb-1">Insights</p>
                        <h3 class="font-display font-bold text-xl mb-3">Spending Report</h3>
                        <p class="text-xs text-white/80 mb-4">You spent 40% less on electronics this month.</p>
                        <button
                            class="w-full py-2 bg-white/20 rounded-xl text-xs font-bold backdrop-blur-sm hover:bg-white/30 transition">View
                            Full Report</button>
                    </div>
                </div>


                <div
                    class="bg-white dark:bg-slate-800 rounded-[2rem] p-8 border border-slate-100 dark:border-slate-700 shadow-sm relative overflow-hidden">
                    <div class="flex justify-between items-end mb-6">
                        <div>
                            <h3 class="font-bold text-lg text-slate-900 dark:text-white">Monthly Savings Trend</h3>
                            <p class="text-xs text-slate-400">Your savings over past 6 months</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-green-500"></span> <span
                                class="text-xs font-bold text-slate-500">Savings</span>
                        </div>
                    </div>

                    <div class="flex items-end justify-between h-40 gap-4 mt-8 px-4">
                        <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-t-xl relative group h-[40%]">
                            <div
                                class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 text-xs font-bold text-slate-900 dark:text-white opacity-0 group-hover:opacity-100 transition">
                                â‚¹2k</div>
                        </div>
                        <div class="w-full bg-indigo-50 dark:bg-indigo-900/20 rounded-t-xl relative group h-[60%]">
                            <div
                                class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 text-xs font-bold text-slate-900 dark:text-white opacity-0 group-hover:opacity-100 transition">
                                â‚¹4.2k</div>
                        </div>
                        <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-t-xl relative group h-[30%]">
                            <div
                                class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 text-xs font-bold text-slate-900 dark:text-white opacity-0 group-hover:opacity-100 transition">
                                â‚¹1.5k</div>
                        </div>
                        <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-t-xl relative group h-[50%]">
                            <div
                                class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 text-xs font-bold text-slate-900 dark:text-white opacity-0 group-hover:opacity-100 transition">
                                â‚¹3.8k</div>
                        </div>
                        <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-t-xl relative group h-[45%]">
                            <div
                                class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 text-xs font-bold text-slate-900 dark:text-white opacity-0 group-hover:opacity-100 transition">
                                â‚¹2.9k</div>
                        </div>
                        <div
                            class="w-full bg-brand-blue rounded-t-xl relative group h-[85%] shadow-lg shadow-blue-500/30">
                            <div
                                class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 text-xs font-bold text-brand-blue opacity-100 transition">
                                â‚¹12.4k</div>
                        </div>
                    </div>
                    <div
                        class="flex justify-between mt-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest px-4">
                        <span>Aug</span><span>Sep</span><span>Oct</span><span>Nov</span><span>Dec</span><span>Jan</span>
                    </div>
                </div>
            </section>


            <section class="mb-20 reveal">

                <h2 class="font-display font-bold text-3xl text-slate-900 dark:text-white mb-8">Shops Near You</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

                    <div
                        class="bg-white dark:bg-slate-800 p-6 rounded-[24px] border border-slate-100 dark:border-slate-700 hover:border-brand-blue/30 transition cursor-pointer">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-full bg-cover bg-center"
                                style="background-image: url('https://images.unsplash.com/photo-1541533260371-b8fc9b036eb1?w=200')">
                            </div>
                            <button
                                class="text-brand-blue text-sm font-bold bg-blue-50 dark:bg-blue-900/30 px-4 py-2 rounded-full hover:bg-brand-blue hover:text-white transition">Follow</button>
                        </div>
                        <h3 class="font-bold text-lg text-slate-900 dark:text-white flex items-center gap-1">Aggarwal
                            Sweets <i class="fas fa-check-circle text-blue-500 text-xs"></i></h3>
                        <p class="text-slate-500 dark:text-slate-400 text-sm mb-4">Food & Beverages â€¢ 2.1km</p>
                        <div
                            class="flex items-center gap-2 text-xs font-semibold text-slate-400 uppercase tracking-wide">
                            <i class="fas fa-users"></i> 12.5k Followers
                        </div>
                    </div>


                    <div
                        class="bg-white dark:bg-slate-800 p-6 rounded-[24px] border border-slate-100 dark:border-slate-700 hover:border-brand-blue/30 transition cursor-pointer">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-full bg-cover bg-center"
                                style="background-image: url('https://images.unsplash.com/photo-1441984904996-e0b6ba687e04?w=200')">
                            </div>
                            <button
                                class="text-slate-400 text-sm font-bold bg-slate-50 dark:bg-slate-700 px-4 py-2 rounded-full hover:bg-slate-200 transition">Unfollow</button>
                        </div>
                        <h3 class="font-bold text-lg text-slate-900 dark:text-white flex items-center gap-1">Verma
                            Fashion <i class="fas fa-check-circle text-blue-500 text-xs"></i></h3>
                        <p class="text-slate-500 dark:text-slate-400 text-sm mb-4">Clothing & Retail â€¢ 0.8km</p>
                        <div
                            class="flex items-center gap-2 text-xs font-semibold text-slate-400 uppercase tracking-wide">
                            <i class="fas fa-users"></i> 4.2k Followers
                        </div>
                    </div>


                    <div
                        class="bg-slate-100 dark:bg-slate-900 p-6 rounded-[24px] border border-slate-200 dark:border-slate-700 flex flex-col items-center justify-center text-center cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-800 transition min-h-[220px]">
                        <div
                            class="w-16 h-16 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-slate-400 mb-4">
                            <i class="fas fa-map-marked-alt text-2xl"></i>
                        </div>
                        <h3 class="font-bold text-lg text-slate-900 dark:text-white">Explore Map</h3>
                        <p class="text-slate-500 dark:text-slate-400 text-sm">Find 20+ more shops nearby</p>
                    </div>
                </div>
            </section>


            <section class="mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <div class="bg-blue-900 rounded-[2rem] p-8 text-white relative overflow-hidden">
                        <div
                            class="absolute top-0 right-0 w-40 h-40 bg-blue-500/30 rounded-full blur-3xl translate-x-1/2 -translate-y-1/2">
                        </div>
                        <h3 class="font-display font-bold text-2xl mb-6 relative z-10"><i
                                class="fas fa-shield-alt mr-2 text-blue-400"></i> Safe Shopping</h3>

                        <div class="space-y-4 relative z-10">
                            <div
                                class="flex items-center gap-3 bg-white/10 p-3 rounded-xl backdrop-blur-sm border border-white/5">
                                <div
                                    class="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center text-green-400 text-xs">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-sm">Verified Merchant Badge</p>
                                    <p class="text-[10px] text-white/60">Only shop at trusted stores</p>
                                </div>
                            </div>
                            <div
                                class="flex items-center gap-3 bg-white/10 p-3 rounded-xl backdrop-blur-sm border border-white/5">
                                <div
                                    class="w-8 h-8 rounded-full bg-yellow-500/20 flex items-center justify-center text-yellow-400 text-xs">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-sm">Fake Offer Detector</p>
                                    <p class="text-[10px] text-white/60">AI scans for price inflation</p>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div
                        class="bg-white dark:bg-slate-800 rounded-[2rem] p-8 border border-slate-100 dark:border-slate-700 shadow-sm relative overflow-hidden cursor-pointer group hover:shadow-xl transition-all duration-300">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="font-display font-bold text-2xl text-slate-900 dark:text-white">Loyalty
                                    Points
                                </h3>
                                <p class="text-sm text-slate-500 dark:text-slate-400">Level 2 Member</p>
                            </div>
                            <div
                                class="w-12 h-12 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-xl font-bold">
                                <i class="fas fa-crown"></i>
                            </div>
                        </div>

                        <div class="mb-6">
                            <div class="flex items-end gap-2 mb-2">
                                <span class="text-4xl font-extrabold text-indigo-600">840</span>
                                <span class="text-sm font-bold text-slate-400 mb-1">pts</span>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-full h-2 overflow-hidden">
                                <div class="bg-indigo-600 h-2 rounded-full" style="width: 70%"></div>
                            </div>
                            <p class="text-[10px] text-slate-400 mt-2 font-bold uppercase tracking-wide">160 pts to next
                                reward</p>
                        </div>

                        <div class="flex gap-3">
                            <button
                                class="flex-1 py-2 bg-indigo-600 text-white rounded-xl text-sm font-bold hover:bg-indigo-700 transition">Refer
                                Friend (+500)</button>
                            <button
                                class="px-4 py-2 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-xl hover:bg-slate-200 transition"><i
                                    class="fas fa-history"></i></button>
                        </div>
                    </div>
                </div>
            </section>


        </div>


        <footer
            class="bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 pt-16 pb-8 mt-20 rounded-t-[3rem]">
            <div class="max-w-7xl mx-auto px-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-12">

                    <div>
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-xl bg-brand-blue flex items-center justify-center text-white">
                                <i class="fas fa-cube text-lg"></i>
                            </div>
                            <span
                                class="font-display font-bold text-xl tracking-tight text-slate-900 dark:text-white">Local<span
                                    class="text-brand-blue">Bridge</span></span>
                        </div>
                        <p class="text-slate-500 dark:text-slate-400 text-sm leading-relaxed mb-6">
                            Empowering local retail with smart warranty management and customer engagement tools.
                        </p>
                        <div class="flex gap-4">
                            <a href="#"
                                class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 dark:text-slate-400 hover:bg-brand-blue hover:text-white transition">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#"
                                class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 dark:text-slate-400 hover:bg-brand-blue hover:text-white transition">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                            <a href="#"
                                class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 dark:text-slate-400 hover:bg-brand-blue hover:text-white transition">
                                <i class="fab fa-instagram"></i>
                            </a>
                        </div>
                    </div>


                    <div>
                        <h4 class="font-bold text-slate-900 dark:text-white mb-6">Product</h4>
                        <ul class="space-y-4 text-sm text-slate-500 dark:text-slate-400">
                            <li><a href="#" class="hover:text-brand-blue transition">Smart Receipt Scanner</a></li>
                            <li><a href="#" class="hover:text-brand-blue transition">Warranty Vault</a></li>
                            <li><a href="#" class="hover:text-brand-blue transition">Expiration Alerts</a></li>
                            <li><a href="#" class="hover:text-brand-blue transition">Pricing</a></li>
                        </ul>
                    </div>


                    <div>
                        <h4 class="font-bold text-slate-900 dark:text-white mb-6">Company</h4>
                        <ul class="space-y-4 text-sm text-slate-500 dark:text-slate-400">
                            <li><a href="#" class="hover:text-brand-blue transition">About Us</a></li>
                            <li><a href="#" class="hover:text-brand-blue transition">Careers</a></li>
                            <li><a href="#" class="hover:text-brand-blue transition">Blog</a></li>
                            <li><a href="#" class="hover:text-brand-blue transition">Contact</a></li>
                        </ul>
                    </div>


                    <div>
                        <h4 class="font-bold text-slate-900 dark:text-white mb-6">Customer Care</h4>
                        <ul class="space-y-4 text-sm text-slate-500 dark:text-slate-400 mb-6">
                            <li class="flex items-start gap-3">
                                <i class="fas fa-envelope mt-1 text-brand-blue"></i>
                                <a href="mailto:support@localbridge.com"
                                    class="hover:text-brand-blue transition">support@localbridge.com</a>
                            </li>
                            <li class="flex items-start gap-3">
                                <i class="fas fa-phone mt-1 text-brand-blue"></i>
                                <span>+91 98765 43210</span>
                            </li>
                            <li class="flex items-start gap-3">
                                <i class="fas fa-map-marker-alt mt-1 text-brand-blue"></i>
                                <span>123 Tech Park, Cyber City,<br>Gurugram, India</span>
                            </li>
                        </ul>
                        <form class="relative">
                            <input type="email" placeholder="Subscribe to newsletter"
                                class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg py-3 px-4 text-sm text-slate-900 dark:text-white focus:outline-none focus:border-brand-blue transition">
                            <button type="button"
                                class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-brand-blue rounded-md flex items-center justify-center text-white hover:bg-blue-600 transition">
                                <i class="fas fa-arrow-right text-xs"></i>
                            </button>
                        </form>
                    </div>
                </div>

                <div
                    class="border-t border-slate-200 dark:border-slate-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                    <p class="text-slate-500 text-xs">Â© 2024 LocalBridge Inc. All rights reserved.</p>
                    <div class="flex gap-6 text-xs text-slate-500">
                        <a href="#" class="hover:text-white transition">Privacy Policy</a>
                        <a href="#" class="hover:text-white transition">Terms of Service</a>
                        <a href="#" class="hover:text-white transition">Cookie Policy</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>


    <div id="merchant-view" class="hidden pt-20 h-screen flex bg-gray-50 dark:bg-slate-900 overflow-hidden">


        <aside
            class="hidden md:flex w-64 bg-white dark:bg-slate-800 border-r border-gray-200 dark:border-slate-700 flex-col flex-shrink-0 z-30">

            <div class="p-4 border-b border-gray-100 dark:border-slate-700 flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-indigo-600 p-[2px] shadow-md flex items-center justify-center overflow-hidden">
                    <div id="sidebar-avatar-initials"
                        class="hidden w-full h-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-xs font-bold text-slate-700 dark:text-slate-200 uppercase">
                        SE
                    </div>
                    <img id="sidebar-avatar-img" src="https://ui-avatars.com/api/?name=S+E&background=random"
                        class="rounded-full w-full h-full object-cover">
                </div>
                <div class="overflow-hidden">
                    <h3 id="sidebar-store-name" class="font-bold text-sm text-slate-900 dark:text-white truncate">
                        Sukhdev Electronics</h3>
                    <p class="text-xs text-slate-500 uppercase">Merchant</p>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto py-4 space-y-1 px-3">
                <div onclick="switchMerchantTab('dashboard')" id="menu-dashboard"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md bg-blue-50 text-blue-700 cursor-pointer transition-colors">
                    <i class="fas fa-chart-pie w-5 text-center"></i> Dashboard
                </div>
                <div onclick="switchMerchantTab('new-sale')" id="menu-new-sale"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                    <i class="fas fa-plus-circle w-5 text-center"></i> New Sale
                </div>
                <div onclick="switchMerchantTab('transactions')" id="menu-transactions"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                    <i class="fas fa-list-ul w-5 text-center"></i> Transactions
                </div>
                <div onclick="switchMerchantTab('my-files')" id="menu-my-files"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                    <i class="fas fa-folder-open w-5 text-center"></i> My Files
                </div>
                <div onclick="switchMerchantTab('broadcast')" id="menu-broadcast"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                    <i class="fas fa-broadcast-tower w-5 text-center"></i> Broadcast
                </div>
                <div onclick="switchMerchantTab('campaigns')" id="menu-campaigns"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                    <i class="fas fa-bullhorn w-5 text-center"></i> Campaigns
                </div>
                <div onclick="switchMerchantTab('customers')" id="menu-customers"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                    <i class="fas fa-users w-5 text-center"></i> Customers
                </div>
                <div onclick="switchMerchantTab('settings')" id="menu-settings"
                    class="flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md text-slate-600 dark:text-slate-400 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                    <i class="fas fa-cog w-5 text-center"></i> Settings
                </div>
            </div>

            <div class="p-4 border-t border-gray-100 dark:border-slate-700">
                <button onclick="authSignOut()"
                    class="w-full flex items-center justify-center gap-2 text-xs font-semibold text-slate-500 hover:text-slate-900 transition">
                    <i class="fas fa-sign-out-alt"></i> Sign Out
                </button>
            </div>
        </aside>


        <div class="flex-1 flex flex-col overflow-hidden pb-16 md:pb-0">
            <main class="flex-1 overflow-y-auto p-4 md:p-8">


                <div id="merchant-dashboard" class="space-y-6 max-w-6xl mx-auto">


                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-2xl font-bold text-slate-900 dark:text-white tracking-tight">Dashboard</h2>
                        <div class="flex gap-2">
                            <select onchange="updateDashboardData(this.value)"
                                class="text-xs text-slate-500 bg-white dark:bg-slate-800 px-3 py-1.5 rounded border border-gray-200 dark:border-slate-700 font-bold focus:ring-2 focus:ring-blue-500 outline-none cursor-pointer">
                                <option value="7days">Last 7 Days</option>
                                <option value="30days" selected>Last 30 Days</option>
                                <option value="quarter">Last Quarter</option>
                                <option value="year">Last Year</option>
                            </select>
                        </div>
                    </div>


                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div
                            class="bg-white dark:bg-slate-800 p-5 rounded-lg border border-gray-200 dark:border-slate-700 shadow-sm relative overflow-hidden group">
                            <div
                                class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity">
                                <i class="fas fa-indian-rupee-sign text-4xl"></i>
                            </div>
                            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">Total Revenue
                            </p>
                            <h3 class="text-3xl font-bold text-slate-900 dark:text-white" id="stat-revenue">â‚¹12.4L</h3>
                            <div class="mt-4 flex items-center text-xs font-medium text-green-600">
                                <i class="fas fa-arrow-up mr-1 text-[10px]"></i> 12.5% <span
                                    class="text-slate-400 ml-1">vs last month</span>
                            </div>
                        </div>

                        <div
                            class="bg-white dark:bg-slate-800 p-5 rounded-lg border border-gray-200 dark:border-slate-700 shadow-sm relative overflow-hidden group">
                            <div
                                class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity">
                                <i class="fas fa-users text-4xl"></i>
                            </div>
                            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">Total
                                Customers</p>
                            <h3 class="text-3xl font-bold text-slate-900 dark:text-white" id="stat-customers">4.2K</h3>
                            <div class="mt-4 flex items-center text-xs font-medium text-green-600">
                                <i class="fas fa-arrow-up mr-1 text-[10px]"></i> 8.2% <span
                                    class="text-slate-400 ml-1">growth</span>
                            </div>
                        </div>

                        <div
                            class="bg-white dark:bg-slate-800 p-5 rounded-lg border border-gray-200 dark:border-slate-700 shadow-sm relative overflow-hidden group">
                            <div
                                class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity">
                                <i class="fas fa-rotate-left text-4xl"></i>
                            </div>
                            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">Repeat
                                Customers</p>
                            <h3 class="text-3xl font-bold text-slate-900 dark:text-white" id="stat-repeat-customers">342
                            </h3>
                            <div class="mt-4 flex items-center text-xs font-medium text-blue-600">
                                <i class="fas fa-check-circle mr-1 text-[10px]"></i> 18% <span
                                    class="text-slate-400 ml-1">loyalty rate</span>
                            </div>
                        </div>

                        <div
                            class="bg-white dark:bg-slate-800 p-5 rounded-lg border border-gray-200 dark:border-slate-700 shadow-sm relative overflow-hidden group">
                            <div
                                class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity">
                                <i class="fas fa-bag-shopping text-4xl"></i>
                            </div>
                            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">Avg. Order
                                Value</p>
                            <h3 class="text-3xl font-bold text-slate-900 dark:text-white" id="stat-aov">â‚¹3,450</h3>
                            <div class="mt-4 flex items-center text-xs font-medium text-blue-600">
                                <span class="w-2 h-2 rounded-full bg-blue-500 mr-2"></span> High value trend
                            </div>
                        </div>
                    </div>


                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                        <div
                            class="lg:col-span-2 bg-white dark:bg-slate-800 p-6 rounded-xl border border-gray-200 dark:border-slate-700 shadow-sm">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="font-bold text-slate-900 dark:text-white" id="chart-title">Revenue Trend</h3>
                                <div class="flex gap-2">
                                    <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                                    <span class="text-[10px] font-bold text-slate-400 uppercase"
                                        id="chart-range-label">Current Period</span>
                                </div>
                            </div>

                            <div class="h-64 w-full relative group" id="revenue-chart-container">

                                <div id="chart-tooltip"
                                    class="absolute hidden z-50 bg-slate-900 text-white text-[10px] font-bold px-2 py-1 rounded shadow-xl pointer-events-none -translate-x-1/2 -translate-y-full mb-2 whitespace-nowrap">
                                    â‚¹0.0
                                </div>

                                <svg viewBox="0 0 700 200" class="w-full h-full overflow-visible"
                                    id="revenue-trend-svg">
                                    <defs>
                                        <linearGradient id="chartGradient" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="0%" stop-color="#3b82f6" stop-opacity="0.2" />
                                            <stop offset="100%" stop-color="#3b82f6" stop-opacity="0" />
                                        </linearGradient>
                                    </defs>

                                    <line x1="0" y1="50" x2="700" y2="50" stroke="currentColor" stroke-dasharray="4"
                                        class="text-slate-100 dark:text-slate-700" />
                                    <line x1="0" y1="100" x2="700" y2="100" stroke="currentColor" stroke-dasharray="4"
                                        class="text-slate-100 dark:text-slate-700" />
                                    <line x1="0" y1="150" x2="700" y2="150" stroke="currentColor" stroke-dasharray="4"
                                        class="text-slate-100 dark:text-slate-700" />


                                    <path id="chart-area"
                                        d="M0,160 L100,140 L200,170 L300,110 L400,130 L500,80 L600,90 L700,40 L700,200 L0,200 Z"
                                        fill="url(#chartGradient)" />


                                    <path id="chart-line"
                                        d="M0,160 L100,140 L200,170 L300,110 L400,130 L500,80 L600,90 L700,40"
                                        fill="none" stroke="#3b82f6" stroke-width="3" stroke-linecap="round"
                                        stroke-linejoin="round" />


                                    <g id="chart-points">
                                        <circle cx="0" cy="160" r="4" fill="#3b82f6"
                                            class="cursor-pointer hover:r-6 transition-all"
                                            onmouseover="showChartTooltip(event, 'â‚¹15,200')"
                                            onmouseout="hideChartTooltip()" />
                                        <circle cx="100" cy="140" r="4" fill="#3b82f6"
                                            class="cursor-pointer hover:r-6 transition-all"
                                            onmouseover="showChartTooltip(event, 'â‚¹18,500')"
                                            onmouseout="hideChartTooltip()" />
                                        <circle cx="200" cy="170" r="4" fill="#3b82f6"
                                            class="cursor-pointer hover:r-6 transition-all"
                                            onmouseover="showChartTooltip(event, 'â‚¹12,800')"
                                            onmouseout="hideChartTooltip()" />
                                        <circle cx="300" cy="110" r="4" fill="#3b82f6"
                                            class="cursor-pointer hover:r-6 transition-all"
                                            onmouseover="showChartTooltip(event, 'â‚¹22,400')"
                                            onmouseout="hideChartTooltip()" />
                                        <circle cx="400" cy="130" r="4" fill="#3b82f6"
                                            class="cursor-pointer hover:r-6 transition-all"
                                            onmouseover="showChartTooltip(event, 'â‚¹19,100')"
                                            onmouseout="hideChartTooltip()" />
                                        <circle cx="500" cy="80" r="4" fill="#3b82f6"
                                            class="cursor-pointer hover:r-6 transition-all"
                                            onmouseover="showChartTooltip(event, 'â‚¹28,500')"
                                            onmouseout="hideChartTooltip()" />
                                        <circle cx="600" cy="90" r="4" fill="#3b82f6"
                                            class="cursor-pointer hover:r-6 transition-all"
                                            onmouseover="showChartTooltip(event, 'â‚¹24,200')"
                                            onmouseout="hideChartTooltip()" />
                                        <circle cx="700" cy="40" r="4" fill="#3b82f6"
                                            class="cursor-pointer hover:r-6 transition-all"
                                            onmouseover="showChartTooltip(event, 'â‚¹35,000')"
                                            onmouseout="hideChartTooltip()" />
                                    </g>
                                </svg>

                                <div
                                    class="flex justify-between mt-4 px-2 text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                                    <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
                                </div>
                            </div>
                        </div>


                        <div
                            class="bg-white dark:bg-slate-800 p-6 rounded-xl border border-gray-200 dark:border-slate-700 shadow-sm">
                            <h3 class="font-bold text-slate-900 dark:text-white mb-6">Recent Activity</h3>
                            <div class="space-y-6">
                                <div class="flex gap-4">
                                    <div
                                        class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center flex-shrink-0 text-xs">
                                        <i class="fas fa-shopping-cart"></i>
                                    </div>
                                    <div class="overflow-hidden">
                                        <p class="text-xs font-bold text-slate-900 dark:text-white truncate">New Sale:
                                            iPhone 15 Pro</p>
                                        <p class="text-[10px] text-slate-500 mt-1">â‚¹1,24,900 â€¢ 2 mins ago</p>
                                    </div>
                                </div>
                                <div class="flex gap-4">
                                    <div
                                        class="w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center flex-shrink-0 text-xs">
                                        <i class="fas fa-broadcast-tower"></i>
                                    </div>
                                    <div class="overflow-hidden">
                                        <p class="text-xs font-bold text-slate-900 dark:text-white truncate">Broadcast
                                            Sent</p>
                                        <p class="text-[10px] text-slate-500 mt-1">To 4.2k customers â€¢ 1 hour ago</p>
                                    </div>
                                </div>
                                <div class="flex gap-4">
                                    <div
                                        class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center flex-shrink-0 text-xs">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div class="overflow-hidden">
                                        <p class="text-xs font-bold text-slate-900 dark:text-white truncate">New
                                            Customer Joined</p>
                                        <p class="text-[10px] text-slate-500 mt-1">Via QR Scan â€¢ 3 hours ago</p>
                                    </div>
                                </div>
                                <div class="flex gap-4">
                                    <div
                                        class="w-8 h-8 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center flex-shrink-0 text-xs">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="overflow-hidden">
                                        <p class="text-xs font-bold text-slate-900 dark:text-white truncate">Warranty
                                            Expiring soon</p>
                                        <p class="text-[10px] text-slate-500 mt-1">14 items next week â€¢ 5 hours ago</p>
                                    </div>
                                </div>
                            </div>
                            <button onclick="switchMerchantTab('transactions')"
                                class="w-full mt-6 py-2 text-xs font-bold text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition">
                                View All Transactions
                            </button>
                        </div>
                    </div>
                </div>


                <div id="merchant-new-sale" class="hidden space-y-6 max-w-2xl mx-auto">
                    <div
                        class="bg-white dark:bg-slate-800 p-8 rounded-2xl border border-gray-200 dark:border-slate-700 shadow-lg">
                        <h3 class="font-bold text-slate-900 dark:text-white text-lg mb-6 flex items-center gap-2">
                            <i class="fas fa-cash-register text-blue-600"></i> Log a New Sale
                        </h3>

                        <div class="space-y-5">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-5">

                                <div>
                                    <label
                                        class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Customer
                                        Name</label>
                                    <input type="text" id="sale-name"
                                        class="block w-full text-base border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-3 border font-mono tracking-wide placeholder-slate-400 transition bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white"
                                        placeholder="e.g. Rahul Sharma">
                                </div>


                                <div>
                                    <label
                                        class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Customer
                                        Mobile</label>
                                    <div class="relative">
                                        <div
                                            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-slate-500 font-bold text-sm">+91</span>
                                        </div>
                                        <input type="tel" id="sale-mobile"
                                            class="block w-full pl-11 text-base border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-3 border font-mono tracking-wide placeholder-slate-400 transition bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white"
                                            placeholder="98765 43210">
                                    </div>
                                </div>


                                <div>
                                    <label
                                        class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Customer
                                        Email</label>
                                    <input type="email" id="sale-email"
                                        class="block w-full text-base border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-3 border font-mono tracking-wide placeholder-slate-400 transition bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white"
                                        placeholder="customer@example.com">
                                </div>


                                <div id="product-list-container" class="col-span-full space-y-4">
                                    <!-- Dynamic product rows will be injected here -->
                                    <div
                                        class="product-row grid grid-cols-1 md:grid-cols-12 gap-4 items-end animate-fade-in group">
                                        <div class="md:col-span-6">
                                            <label
                                                class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Product
                                                Name</label>
                                            <input type="text"
                                                class="product-name block w-full text-sm border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-2.5 border font-mono transition bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white"
                                                placeholder="e.g. iPhone 15 Pro">
                                        </div>
                                        <div class="md:col-span-3">
                                            <label
                                                class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Price
                                                (â‚¹)</label>
                                            <div class="relative">
                                                <span
                                                    class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400 text-sm">â‚¹</span>
                                                <input type="number" oninput="calculateTotal()"
                                                    class="product-price block w-full pl-7 text-sm border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-2.5 border font-mono transition bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white"
                                                    placeholder="0.00">
                                            </div>
                                        </div>
                                        <div class="md:col-span-2">
                                            <label
                                                class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Qty</label>
                                            <input type="number" oninput="calculateTotal()" value="1" min="1"
                                                class="product-qty block w-full text-sm border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-2.5 border font-mono transition bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white">
                                        </div>
                                        <div class="md:col-span-1 pb-1 flex justify-center">
                                            <button type="button" onclick="removeProductRow(this)"
                                                class="text-slate-300 hover:text-red-500 transition-colors p-2 opacity-0 group-hover:opacity-100">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div
                                    class="col-span-full pt-2 flex items-center justify-between border-t border-slate-100 dark:border-slate-700 mt-2">
                                    <button type="button" onclick="addProductRow()"
                                        class="text-blue-600 hover:text-blue-700 font-bold text-xs uppercase tracking-wider flex items-center gap-2 px-3 py-1.5 rounded-lg hover:bg-blue-50 transition">
                                        <i class="fas fa-plus-circle"></i> Add Another Product
                                    </button>
                                    <div class="text-right">
                                        <span
                                            class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-0.5">Total
                                            Sale Amount</span>
                                        <span class="text-xl font-display font-black text-brand-blue"
                                            id="sale-total-display">â‚¹0.00</span>
                                        <input type="hidden" id="sale-amount" value="0">
                                    </div>
                                </div>
                            </div>

                            <div
                                class="grid grid-cols-1 md:grid-cols-2 gap-5 mt-8 border-t border-slate-100 dark:border-slate-700 pt-6">


                                <div>
                                    <label
                                        class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Payment
                                        Status</label>
                                    <select id="sale-status"
                                        class="block w-full text-sm border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-3 bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white transition hover:border-blue-400 cursor-pointer border font-bold">
                                        <option value="Paid" selected>Paid Full</option>
                                        <option value="Pending">Pending (Friend/Credit)</option>
                                    </select>
                                </div>
                            </div>


                            <div class="grid grid-cols-2 gap-5">

                                <div>
                                    <label
                                        class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Warranty</label>
                                    <select id="sale-warranty"
                                        class="block w-full text-sm border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-3 bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white transition hover:border-blue-400 cursor-pointer border">
                                        <option value="none">None</option>
                                        <option value="7d">7 Days</option>
                                        <option value="1m">1 Month</option>
                                        <option value="6m">6 Months</option>
                                        <option value="1y" selected>1 Year</option>
                                        <option value="lifetime">Lifetime</option>
                                    </select>
                                </div>


                                <div>
                                    <label
                                        class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Return</label>
                                    <select id="sale-return"
                                        class="block w-full text-sm border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-3 bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white transition hover:border-blue-400 cursor-pointer border">
                                        <option value="none">No Return</option>
                                        <option value="3d">3 Days</option>
                                        <option value="7d">7 Days</option>
                                        <option value="30d">30 Days</option>
                                    </select>
                                </div>
                            </div>


                            <div class="pt-2">
                                <button onclick="registerSale(event)"
                                    class="w-full flex justify-center items-center gap-3 py-3 px-6 border border-transparent shadow-xl text-base font-bold rounded-xl text-white bg-blue-600 hover:bg-blue-700 active:scale-[0.98] transition-all focus:outline-none focus:ring-4 focus:ring-blue-500/50">
                                    <i class="fas fa-check-circle text-lg"></i>
                                    Confirm & Log Sale
                                </button>
                                <p class="text-[10px] text-center text-slate-400 mt-3 font-medium">
                                    <i class="fas fa-info-circle mr-1 text-blue-500"></i> Receipt will be generated
                                    automatically for the customer.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="merchant-transactions" class="hidden space-y-6 max-w-6xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900 dark:text-white tracking-tight">Recent Transactions
                        </h2>
                        <div class="flex gap-4">
                            <div class="relative">
                                <i
                                    class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                                <input type="text" id="transaction-search" onkeyup="filterTransactions()"
                                    placeholder="Search by name, mobile or product..."
                                    class="border border-gray-300 dark:border-slate-700 rounded-lg pl-10 pr-4 py-2 text-sm bg-white dark:bg-slate-800 dark:text-white transition focus:ring-2 focus:ring-blue-500 w-64">
                            </div>
                            <button
                                class="text-xs text-slate-500 bg-white dark:bg-slate-800 px-4 py-2 rounded border border-gray-200 dark:border-slate-700 font-bold flex items-center gap-2 hover:bg-gray-50 transition">
                                <i class="fas fa-download"></i> Export CSV
                            </button>
                        </div>
                    </div>
                    <div
                        class="bg-white dark:bg-slate-800 rounded-xl border border-gray-200 dark:border-slate-700 shadow-sm overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead
                                    class="text-xs text-slate-500 uppercase bg-gray-50 dark:bg-slate-700/50 border-b border-gray-200 dark:border-slate-700">
                                    <tr>
                                        <th class="px-6 py-4 font-bold tracking-wider">Customer</th>
                                        <th class="px-6 py-4 font-bold tracking-wider">Product</th>
                                        <th class="px-6 py-4 font-bold tracking-wider">Policies</th>
                                        <th class="px-6 py-4 font-bold tracking-wider">Date</th>
                                        <th class="px-6 py-4 font-bold tracking-wider text-right">Amount</th>
                                        <th class="px-6 py-4 font-bold tracking-wider text-right">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100 dark:divide-slate-700" id="transactions-body">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


                <!-- My Files Section -->
                <div id="merchant-my-files" class="hidden space-y-6 max-w-6xl mx-auto animate-fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-2">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-900 dark:text-white tracking-tight">My Files &
                                Assets</h2>
                            <p class="text-xs text-slate-500 mt-1">Manage your business documents, notes, and team data.
                            </p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="toggleModal('modal-new-folder', true)"
                                class="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-xs font-bold text-slate-700 dark:text-slate-200 hover:bg-slate-50 transition flex items-center gap-2">
                                <i class="fas fa-folder-plus text-blue-500"></i> New Folder
                            </button>
                            <button onclick="toggleModal('modal-add-file', true)"
                                class="px-4 py-2 bg-blue-600 text-white rounded-xl text-xs font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-500/20 flex items-center gap-2">
                                <i class="fas fa-file-upload"></i> Add File
                            </button>
                        </div>
                    </div>

                    <!-- Stats Bar -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <div
                            class="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm">
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Total Folders
                            </p>
                            <h4 id="count-folders" class="text-xl font-bold text-slate-900 dark:text-white">0</h4>
                        </div>
                        <div
                            class="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm">
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Total Files
                            </p>
                            <h4 id="count-files" class="text-xl font-bold text-slate-900 dark:text-white">0</h4>
                        </div>
                        <div
                            class="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm">
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Active Notes
                            </p>
                            <h4 id="count-notes" class="text-xl font-bold text-slate-900 dark:text-white">0</h4>
                        </div>
                        <div
                            class="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm">
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Team Members
                            </p>
                            <h4 id="count-members" class="text-xl font-bold text-slate-900 dark:text-white">0</h4>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Left: Folders & Files -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Folders List -->
                            <div
                                class="bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm overflow-hidden">
                                <div
                                    class="px-6 py-4 border-b border-slate-50 dark:border-slate-700 flex justify-between items-center">
                                    <h3 class="font-bold text-slate-900 dark:text-white text-sm">Folders</h3>
                                    <span class="text-[10px] font-bold text-slate-400 uppercase">Recent</span>
                                </div>
                                <div id="folders-grid" class="p-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <!-- Empty State placeholder -->
                                    <div id="folders-loading"
                                        class="col-span-full py-12 flex flex-col items-center justify-center text-slate-400">
                                        <i class="fas fa-circle-notch fa-spin text-2xl mb-2"></i>
                                        <p class="text-xs font-bold">Syncing folders...</p>
                                    </div>
                                    <div id="folders-empty"
                                        class="hidden col-span-full py-12 flex flex-col items-center justify-center text-slate-300">
                                        <i class="fas fa-folder-open text-4xl mb-3"></i>
                                        <p class="text-xs font-bold">No folders created yet</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Files List -->
                            <div
                                class="bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm overflow-hidden">
                                <div
                                    class="px-6 py-4 border-b border-slate-50 dark:border-slate-700 flex justify-between items-center">
                                    <h3 class="font-bold text-slate-900 dark:text-white text-sm">Recent Files</h3>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-xs text-left">
                                        <thead
                                            class="bg-slate-50 dark:bg-slate-700/50 text-slate-500 uppercase font-bold tracking-widest">
                                            <tr>
                                                <th class="px-6 py-4">Name</th>
                                                <th class="px-6 py-4">Folder</th>
                                                <th class="px-6 py-4 text-right">Size</th>
                                                <th class="px-6 py-4 text-right">Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="files-list-body"
                                            class="divide-y divide-slate-50 dark:divide-slate-700">
                                            <!-- Loading State -->
                                            <tr id="files-loading">
                                                <td colspan="4" class="px-6 py-12 text-center text-slate-400">
                                                    <i class="fas fa-circle-notch fa-spin mb-2"></i>
                                                    <p class="font-bold">Loading assets...</p>
                                                </td>
                                            </tr>
                                            <!-- Empty State -->
                                            <tr id="files-empty" class="hidden">
                                                <td colspan="4" class="px-6 py-12 text-center text-slate-300">
                                                    <p class="font-bold">No files found</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Right: Notes & Team -->
                        <div class="space-y-6">
                            <!-- Notes Section -->
                            <div
                                class="bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm overflow-hidden">
                                <div
                                    class="px-6 py-4 border-b border-slate-50 dark:border-slate-700 flex justify-between items-center">
                                    <h3 class="font-bold text-slate-900 dark:text-white text-sm">Quick Notes</h3>
                                    <button onclick="toggleModal('modal-new-note', true)"
                                        class="text-blue-600 hover:text-blue-700 transition-transform active:scale-95">
                                        <i class="fas fa-plus-circle"></i>
                                    </button>
                                </div>
                                <div id="notes-list" class="p-4 space-y-3">
                                    <div id="notes-loading" class="py-10 text-center text-slate-400">
                                        <i class="fas fa-spinner fa-spin text-sm"></i>
                                    </div>
                                    <div id="notes-empty"
                                        class="hidden py-10 text-center text-slate-300 text-xs font-bold uppercase tracking-widest">
                                        Empty
                                    </div>
                                </div>
                            </div>

                            <!-- Team Members -->
                            <div
                                class="bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm overflow-hidden">
                                <div
                                    class="px-6 py-4 border-b border-slate-50 dark:border-slate-700 flex justify-between items-center">
                                    <h3 class="font-bold text-slate-900 dark:text-white text-sm">Team Members</h3>
                                    <button onclick="toggleModal('modal-add-member', true)"
                                        class="text-blue-600 hover:text-blue-700 transition-transform active:scale-95">
                                        <i class="fas fa-user-plus"></i>
                                    </button>
                                </div>
                                <div id="team-list" class="p-4 space-y-3">
                                    <div id="team-loading" class="py-10 text-center text-slate-400">
                                        <i class="fas fa-spinner fa-spin text-sm"></i>
                                    </div>
                                    <div id="team-empty"
                                        class="hidden py-10 text-center text-slate-300 text-xs font-bold uppercase tracking-widest">
                                        Invite Team
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="merchant-broadcast" class="hidden space-y-6 max-w-4xl mx-auto">
                    <div
                        class="bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 shadow-xl overflow-hidden">
                        <div
                            class="p-8 border-b border-gray-100 dark:border-slate-700 bg-gray-50/50 dark:bg-slate-800/50">
                            <h3 class="font-bold text-slate-900 dark:text-white text-lg flex items-center gap-3">
                                <i class="fas fa-bullhorn text-blue-600"></i> Send Smart Broadcast
                            </h3>
                            <p class="text-[10px] text-slate-500 mt-2 uppercase font-bold tracking-widest">Reach your
                                customers directly with instant offers and
                                updates.</p>
                        </div>
                        <div class="p-8 grid grid-cols-1 md:grid-cols-2 gap-10">
                            <div class="space-y-6">
                                <div>
                                    <label
                                        class="block text-xs font-bold text-slate-500 mb-2 uppercase tracking-wide">Target
                                        Audience</label>
                                    <select id="broadcast-audience" onchange="updateBroadcastReach()"
                                        class="block w-full text-base border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-4 bg-white dark:bg-slate-900 dark:border-slate-600 dark:text-white border transition shadow-sm font-bold">
                                        <option value="all">All Customers (4.2K)</option>
                                        <option value="vip">Generic (High Value) (850)</option>
                                        <option value="inactive">Inactive > 30 Days (1.2K)</option>
                                    </select>
                                </div>

                                <div
                                    class="bg-blue-50 dark:bg-blue-900/10 rounded-xl p-6 flex justify-between items-center border border-blue-100 dark:border-blue-800/50">
                                    <div>
                                        <p
                                            class="text-[10px] text-blue-700 dark:text-blue-300 font-bold uppercase tracking-widest mb-1">
                                            Estimated Reach</p>
                                        <span id="broadcast-reach"
                                            class="text-3xl font-black text-blue-800 dark:text-blue-200">4,200 <span
                                                class="text-xs font-medium opacity-70">users</span></span>
                                    </div>
                                    <i class="fas fa-users-viewfinder text-4xl text-blue-200 dark:text-blue-800"></i>
                                </div>

                                <div>
                                    <label
                                        class="block text-xs font-bold text-slate-500 mb-2 uppercase tracking-wide">Broadcast
                                        Message</label>
                                    <textarea id="broadcast-message" rows="5"
                                        class="block w-full text-base border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-4 resize-none bg-white dark:bg-slate-900 dark:border-slate-600 dark:text-white border shadow-sm transition"
                                        placeholder="Type your compelling offer here..."
                                        oninput="updatePreview()"></textarea>
                                    <div class="flex justify-between mt-2 px-1">
                                        <span class="text-[10px] text-slate-400 font-medium">Avoid using too many emojis
                                            for better
                                            delivery</span>
                                        <span class="text-xs font-bold text-blue-600" id="char-count">0/160</span>
                                    </div>
                                </div>

                                <button onclick="sendBroadcast()"
                                    class="w-full flex justify-center items-center gap-3 px-6 py-4 bg-slate-900 dark:bg-blue-600 hover:bg-black dark:hover:bg-blue-700 text-white text-base font-bold rounded-xl transition-all shadow-xl active:scale-[0.98]">
                                    <i class="fas fa-paper-plane"></i> Send Blast Now
                                </button>
                            </div>


                            <div class="flex flex-col items-center justify-center">
                                <div
                                    class="relative w-64 h-[500px] border-8 border-slate-900 rounded-[3rem] bg-white shadow-2xl overflow-hidden scale-90 lg:scale-100">
                                    <div
                                        class="absolute top-0 w-1/3 h-6 bg-slate-900 left-1/2 -translate-x-1/2 rounded-b-2xl z-10">
                                    </div>
                                    <div class="h-full pt-12 pb-6 px-4 flex flex-col bg-gray-100">
                                        <div
                                            class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200 animate-bounce-subtle">
                                            <div class="flex items-center gap-2 mb-2">
                                                <div
                                                    class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center">
                                                    <i class="fas fa-cube text-[10px] text-blue-600"></i>
                                                </div>
                                                <span
                                                    class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">LocalBridge</span>
                                            </div>
                                            <p id="preview-text"
                                                class="text-xs text-slate-700 leading-relaxed font-medium">Hello there!
                                                Your message will appear here as a live preview...</p>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-[10px] font-bold uppercase text-slate-400 mt-4 tracking-widest">Customer
                                    Notification Preview</p>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="merchant-campaigns" class="hidden space-y-6 max-w-6xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900 dark:text-white">Marketing Campaigns</h2>
                        <button onclick="createCampaign()"
                            class="px-6 py-3 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-500/20">
                            <i class="fas fa-plus mr-2"></i> Create New
                        </button>
                    </div>

                    <div id="merchant-campaigns-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Campaigns will be loaded here -->
                        <div class="col-span-full py-12 text-center text-slate-400">
                            <i class="fas fa-bullhorn text-4xl mb-4 opacity-20"></i>
                            <p>Loading your active campaigns...</p>
                        </div>
                    </div>
                </div>


                <div id="merchant-customers" class="hidden space-y-6 max-w-6xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900 dark:text-white">Customer Directory</h2>
                        <div class="flex gap-4">
                            <div class="relative">
                                <i
                                    class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                                <input type="text" id="customer-search" onkeyup="filterCustomers()"
                                    placeholder="Search customers..."
                                    class="border border-gray-300 dark:border-slate-700 rounded-lg pl-10 pr-4 py-2 text-sm bg-white dark:bg-slate-800 dark:text-white transition focus:ring-2 focus:ring-blue-500">
                            </div>
                            <button
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700 transition">
                                <i class="fas fa-user-plus mr-2"></i> Add Customer
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1">
                            <div
                                class="bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 shadow-sm overflow-hidden">
                                <div
                                    class="px-6 py-4 border-b border-gray-100 dark:border-slate-700 bg-gray-50/50 dark:bg-slate-800/50">
                                    <h3 class="font-bold text-slate-900 dark:text-white text-sm">Top Loyalty Customers
                                    </h3>
                                </div>
                                <div class="divide-y divide-gray-100 dark:divide-slate-700">
                                    <div
                                        class="p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-slate-700/50 transition">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-sm font-bold">
                                                JD</div>
                                            <div>
                                                <p
                                                    class="text-sm font-bold text-slate-900 dark:text-white leading-none">
                                                    Jaskaran D.</p>
                                                <p class="text-xs text-slate-500 mt-1">12 Orders â€¢ Joined 2023</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-sm font-bold text-slate-900 dark:text-white font-mono">â‚¹45k
                                            </p>
                                        </div>
                                    </div>
                                    <div
                                        class="p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-slate-700/50 transition">
                                        <div class="flex items-center gap-3">
                                            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100"
                                                class="w-10 h-10 rounded-full object-cover border border-gray-200">
                                            <div>
                                                <p
                                                    class="text-sm font-bold text-slate-900 dark:text-white leading-none">
                                                    Amit Kumar</p>
                                                <p class="text-xs text-slate-500 mt-1">8 Orders â€¢ Joined 2024</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-sm font-bold text-slate-900 dark:text-white font-mono">â‚¹32k
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-2 space-y-8">

                            <div
                                class="bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 shadow-sm overflow-hidden">
                                <div
                                    class="px-6 py-4 border-b border-gray-100 dark:border-slate-700 bg-orange-50/50 dark:bg-orange-900/10 flex justify-between items-center">
                                    <h3
                                        class="font-bold text-slate-900 dark:text-white text-sm flex items-center gap-2">
                                        <i class="fas fa-book-open text-orange-600"></i> Credit Ledger (Khata)
                                    </h3>
                                    <span
                                        class="text-[10px] font-bold text-orange-700 uppercase tracking-widest bg-orange-100 px-2 py-0.5 rounded border border-orange-200"
                                        id="total-credit-count">2 Pending</span>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left">
                                        <thead>
                                            <tr class="bg-gray-50 dark:bg-slate-900/50">
                                                <th
                                                    class="px-6 py-3 text-[10px] font-bold text-slate-400 uppercase tracking-wider">
                                                    Customer</th>
                                                <th
                                                    class="px-6 py-3 text-[10px] font-bold text-slate-400 uppercase tracking-wider">
                                                    Last Product</th>
                                                <th
                                                    class="px-6 py-3 text-[10px] font-bold text-slate-400 uppercase tracking-wider">
                                                    Pending Since</th>
                                                <th
                                                    class="px-6 py-3 text-[10px] font-bold text-slate-400 uppercase tracking-wider text-right">
                                                    Credit Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody id="credit-ledger-body"
                                            class="divide-y divide-gray-100 dark:divide-slate-700">

                                            <tr
                                                class="hover:bg-gray-50 dark:hover:bg-slate-700/50 transition border-l-4 border-orange-500">
                                                <td class="px-6 py-4">
                                                    <p class="text-sm font-bold text-slate-900 dark:text-white">Rahul
                                                        Sharma</p>
                                                    <p class="text-[10px] text-slate-500">+91 98234 56789</p>
                                                </td>
                                                <td class="px-6 py-4 text-xs text-slate-600 dark:text-slate-400">Sony
                                                    Headphones</td>
                                                <td class="px-6 py-4 text-xs text-slate-500">2 days ago</td>
                                                <td class="px-6 py-4 text-sm font-bold text-orange-600 text-right">
                                                    â‚¹8,499</td>
                                            </tr>
                                            <tr
                                                class="hover:bg-gray-50 dark:hover:bg-slate-700/50 transition border-l-4 border-orange-500">
                                                <td class="px-6 py-4">
                                                    <p class="text-sm font-bold text-slate-900 dark:text-white">Preeti
                                                        V.</p>
                                                    <p class="text-[10px] text-slate-500">+91 88765 43210</p>
                                                </td>
                                                <td class="px-6 py-4 text-xs text-slate-600 dark:text-slate-400">AirPods
                                                    Pro</td>
                                                <td class="px-6 py-4 text-xs text-slate-500">1 week ago</td>
                                                <td class="px-6 py-4 text-sm font-bold text-orange-600 text-right">
                                                    â‚¹24,900</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>


                            <div
                                class="bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-8 text-center shadow-sm">
                                <div
                                    class="w-16 h-16 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-400 mx-auto mb-4">
                                    <i class="fas fa-address-book text-2xl"></i>
                                </div>
                                <h3 class="font-bold text-slate-900 dark:text-white mb-2">Customer Base</h3>
                                <p class="text-sm text-slate-500 max-w-xs mx-auto mb-6">You have 4.2k customers in your
                                    store database. Use the search to manage individual profiles.</p>
                                <button
                                    class="px-6 py-2 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-lg text-xs font-bold hover:bg-slate-200 transition">
                                    Manage Directory
                                </button>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="merchant-settings" class="hidden space-y-6 max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-6">Store Settings</h2>
                    <div
                        class="bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-8 shadow-sm space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label
                                    class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">Store
                                    Name</label>
                                <input type="text" id="set-store-name" value="Sukhdev Electronics"
                                    class="block w-full border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-3 border dark:bg-slate-900 dark:border-slate-700 dark:text-white">
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">Primary
                                    Contact</label>
                                <input type="tel" id="set-store-phone" value="98765 43210"
                                    class="block w-full border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-3 border dark:bg-slate-900 dark:border-slate-700 dark:text-white">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label
                                    class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">Profile
                                    Picture</label>
                                <div class="flex items-center gap-4">
                                    <div class="relative group cursor-pointer"
                                        onclick="document.getElementById('set-store-pic-file').click()">
                                        <div
                                            class="w-16 h-16 rounded-full bg-slate-100 dark:bg-slate-700 border-2 border-dashed border-gray-300 dark:border-slate-600 flex items-center justify-center overflow-hidden group-hover:border-blue-500 transition-colors">
                                            <img id="set-store-pic-preview"
                                                src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200"
                                                class="w-full h-full object-cover">
                                            <div
                                                class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                                <i class="fas fa-camera text-white"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex-1">
                                        <input type="file" id="set-store-pic-file" accept="image/*" class="hidden"
                                            onchange="window.handleProfilePicSelect(event)">
                                        <button type="button"
                                            onclick="document.getElementById('set-store-pic-file').click()"
                                            class="text-xs font-bold text-blue-600 dark:text-blue-400 hover:text-blue-700 border border-blue-200 dark:border-blue-800 rounded-lg px-3 py-2 transition-all">
                                            Choose from Gallery
                                        </button>
                                        <input type="hidden" id="set-store-pic"
                                            value="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">Store
                                    Bio</label>
                                <input type="text" id="set-store-bio" placeholder="Full stack electronics shop"
                                    value="Full stack electronics shop"
                                    class="block w-full border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-3 border dark:bg-slate-900 dark:border-slate-700 dark:text-white">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">Store
                                Address</label>
                            <textarea id="set-store-address" rows="3"
                                class="block w-full border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-3 border dark:bg-slate-900 dark:border-slate-700 dark:text-white">Shop No. 42, Sector 17, Chandigarh</textarea>
                        </div>
                        <div
                            class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-900 rounded-xl border border-slate-100 dark:border-slate-800">
                            <div>
                                <h4 class="text-sm font-bold text-slate-900 dark:text-white">WhatsApp & Email Receipts
                                </h4>
                                <p class="text-xs text-slate-500">Enable one-click WhatsApp bills & automated emails</p>
                            </div>
                            <div class="w-12 h-6 bg-blue-600 rounded-full relative cursor-pointer"
                                onclick="this.classList.toggle('bg-blue-600'); this.classList.toggle('bg-gray-400'); this.children[0].classList.toggle('right-1'); this.children[0].classList.toggle('left-1');">
                                <div class="absolute right-1 top-1 w-4 h-4 bg-white rounded-full transition-all"></div>
                            </div>
                        </div>
                        <p class="text-[10px] text-slate-400 italic px-2">Note: WhatsApp messages will send
                            automatically in the background.</p>

                        <!-- API Settings -->
                        <div class="pt-6 border-t border-gray-100 dark:border-slate-700">
                            <h3 class="text-sm font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-key text-blue-600"></i> API Configuration
                            </h3>
                            <div class="space-y-4">
                                <div class="bg-blue-50/50 dark:bg-blue-900/10 p-4 rounded-xl space-y-3">
                                    <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">EmailJS
                                        (Email)</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <input type="text" id="api-emailjs-service" placeholder="Service ID"
                                            class="block w-full text-xs border-gray-200 rounded-lg p-2.5 border dark:bg-slate-900 dark:border-slate-700 dark:text-white">
                                        <input type="text" id="api-emailjs-template" placeholder="Template ID"
                                            class="block w-full text-xs border-gray-200 rounded-lg p-2.5 border dark:bg-slate-900 dark:border-slate-700 dark:text-white">
                                    </div>
                                    <input type="password" id="api-emailjs-public" placeholder="Public Key"
                                        class="block w-full text-xs border-gray-200 rounded-lg p-2.5 border dark:bg-slate-900 dark:border-slate-700 dark:text-white">
                                </div>
                                <div class="bg-emerald-50/50 dark:bg-emerald-900/10 p-4 rounded-xl space-y-3">
                                    <div class="flex items-center justify-between">
                                        <p class="text-[10px] font-bold text-emerald-600 uppercase tracking-widest">
                                            WhatsApp Automation (Ultramsg)</p>
                                        <a href="https://ultramsg.com/" target="_blank"
                                            class="text-[8px] text-emerald-500 hover:underline">Get Free
                                            Instance</a>
                                    </div>
                                    <input type="text" id="api-wa-instance"
                                        placeholder="Instance ID (e.g. instance1234)"
                                        class="block w-full text-xs border-gray-200 rounded-lg p-2.5 border dark:bg-slate-900 dark:border-slate-700 dark:text-white">
                                    <input type="password" id="api-wa-token" placeholder="Ultramsg Token"
                                        class="block w-full text-xs border-gray-200 rounded-lg p-2.5 border dark:bg-slate-900 dark:border-slate-700 dark:text-white">
                                </div>
                            </div>
                        </div>
                        <button onclick="saveSettings()"
                            class="w-full py-4 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-500/20">
                            Save Changes
                        </button>
                    </div>
                </div>

            </main>
        </div>


        <div
            class="md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 border-t border-gray-200 dark:border-slate-700 flex items-center justify-around h-16 z-40 px-2 pb-safe">
            <button onclick="switchMerchantTab('dashboard')" id="mobile-menu-dashboard"
                class="flex flex-col items-center gap-1 text-blue-600 transition-colors">
                <i class="fas fa-chart-pie text-lg"></i>
                <span class="text-[10px] font-bold">Dash</span>
            </button>
            <button onclick="switchMerchantTab('new-sale')" id="mobile-menu-new-sale"
                class="flex flex-col items-center gap-1 text-slate-400 dark:text-slate-500 transition-colors">
                <i class="fas fa-plus-circle text-lg"></i>
                <span class="text-[10px] font-bold">New</span>
            </button>
            <button onclick="switchMerchantTab('transactions')" id="mobile-menu-transactions"
                class="flex flex-col items-center gap-1 text-slate-400 dark:text-slate-500 transition-colors">
                <i class="fas fa-list-ul text-lg"></i>
                <span class="text-[10px] font-bold">Sales</span>
            </button>
            <button onclick="toggleMobileMoreMenu()" id="mobile-menu-more"
                class="flex flex-col items-center gap-1 text-slate-400 dark:text-slate-500 transition-colors">
                <i class="fas fa-ellipsis-h text-lg"></i>
                <span class="text-[10px] font-bold">More</span>
            </button>
        </div>


        <div id="mobile-more-overlay"
            class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex flex-col justify-end transition-opacity duration-300">
            <div id="more-menu-content"
                class="bg-white dark:bg-slate-800 rounded-t-[32px] p-6 space-y-2 transform translate-y-full transition-transform duration-300 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h4 class="font-bold text-slate-900 dark:text-white">Merchant Tools</h4>
                    <button onclick="toggleMobileMoreMenu()"
                        class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center">
                        <i class="fas fa-times text-slate-500"></i>
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div onclick="switchMerchantTab('my-files'); toggleMobileMoreMenu()"
                        class="p-4 rounded-2xl bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 flex flex-col gap-2">
                        <i class="fas fa-folder-open text-blue-600 text-xl"></i>
                        <span class="text-sm font-bold text-slate-900 dark:text-white">My Files</span>
                    </div>
                    <div onclick="switchMerchantTab('broadcast'); toggleMobileMoreMenu()"
                        class="p-4 rounded-2xl bg-gray-50 dark:bg-slate-900/50 flex flex-col gap-2">
                        <i class="fas fa-broadcast-tower text-blue-600 text-xl"></i>
                        <span class="text-sm font-bold text-slate-900 dark:text-white">Broadcast</span>
                    </div>
                    <div onclick="switchMerchantTab('campaigns'); toggleMobileMoreMenu()"
                        class="p-4 rounded-2xl bg-gray-50 dark:bg-slate-900/50 flex flex-col gap-2">
                        <i class="fas fa-bullhorn text-purple-600 text-xl"></i>
                        <span class="text-sm font-bold text-slate-900 dark:text-white">Campaigns</span>
                    </div>
                    <div onclick="switchMerchantTab('customers'); toggleMobileMoreMenu()"
                        class="p-4 rounded-2xl bg-gray-50 dark:bg-slate-900/50 flex flex-col gap-2">
                        <i class="fas fa-users text-green-600 text-xl"></i>
                        <span class="text-sm font-bold text-slate-900 dark:text-white">Customers</span>
                    </div>
                    <div onclick="switchMerchantTab('settings'); toggleMobileMoreMenu()"
                        class="p-4 rounded-2xl bg-gray-50 dark:bg-slate-900/50 flex flex-col gap-2">
                        <i class="fas fa-cog text-slate-500 text-xl"></i>
                        <span class="text-sm font-bold text-slate-900 dark:text-white">Settings</span>
                    </div>
                </div>
                <div class="pt-6">
                    <button onclick="authSignOut()"
                        class="w-full flex items-center justify-center gap-2 py-4 text-sm font-bold text-red-500 bg-red-50 dark:bg-red-900/20 rounded-xl">
                        <i class="fas fa-sign-out-alt"></i> Sign Out
                    </button>
                </div>
            </div>
        </div>
    </div>



    <div id="receipt-modal"
        class="fixed inset-0 z-[100] hidden items-center justify-center p-6 bg-slate-900/80 backdrop-blur-sm transition-opacity opacity-0"
        onclick="if(event.target === this) closeReceipt()">

        <div class="relative flex flex-col items-center animate-pop">

            <div class="receipt-paper bg-white w-full max-w-[380px] relative text-slate-900 overflow-hidden rounded-[2rem]"
                id="modal-content">


                <div class="h-2 bg-brand-blue w-full"></div>


                <div class="bg-slate-50 border-b border-slate-200 p-8 pb-6 text-center relative">

                    <div
                        class="absolute top-4 right-4 w-20 h-20 border-4 border-green-500 rounded-full flex items-center justify-center -rotate-12 opacity-80 pointer-events-none">
                        <span class="text-green-600 font-bold text-lg uppercase tracking-widest leading-none"
                            style="transform: rotate(-5deg);">PAID</span>
                    </div>

                    <div
                        class="w-16 h-16 rounded-2xl bg-white border border-slate-100 shadow-sm text-brand-blue flex items-center justify-center mb-4 mx-auto">
                        <i class="fas fa-store text-2xl"></i>
                    </div>
                    <h3 class="font-display font-bold text-2xl text-slate-900 mb-1" id="modal-shop">Store Name</h3>
                    <p class="text-xs text-slate-500 font-medium">Verified Merchant â€¢ 123 Market Street</p>
                </div>


                <div class="p-8 pb-12 font-receipt text-sm">
                    <div class="flex justify-between mb-2">
                        <span class="text-slate-500">Date:</span>
                        <span class="font-bold text-slate-800">Oct 24, 2024</span>
                    </div>
                    <div class="flex justify-between mb-6">
                        <span class="text-slate-500">Receipt #:</span>
                        <span class="font-bold text-slate-800">#TRX-8859</span>
                    </div>

                    <div class="border-b border-dashed border-slate-300 mb-6"></div>


                    <div id="modal-items-container" class="space-y-4">
                        <!-- Multiple dynamic products will be injected here -->
                    </div>

                    <div class="border-b border-dashed border-slate-300 mb-6 mt-4"></div>


                    <div class="space-y-2 text-slate-600">
                        <div class="flex justify-between">
                            <span>Subtotal</span>
                            <span id="modal-subtotal">â‚¹0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Tax (0%)</span>
                            <span id="modal-tax">â‚¹0.00</span>
                        </div>
                    </div>


                    <div class="flex justify-between items-end mt-6 pt-6 border-t-2 border-slate-900 font-display">
                        <span class="font-bold text-lg text-slate-900">TOTAL</span>
                        <span class="font-extrabold text-2xl text-brand-blue" id="modal-total">â‚¹0.00</span>
                    </div>
                </div>


                <div class="bg-slate-50 p-6 text-center border-t border-slate-200">
                    <div class="h-10 mx-auto w-3/4 opacity-70 mb-2">
                        <div class="w-full h-full flex items-center justify-center text-slate-800 text-[10px] tracking-[0.5em] font-mono select-none bg-repeat-x"
                            style="background-image: repeating-linear-gradient(90deg, black 0, black 2px, transparent 2px, transparent 4px);">
                        </div>
                    </div>
                    <p class="text-[10px] text-slate-400 uppercase tracking-widest font-bold">Thank You For Your
                        Business</p>
                </div>


                <div class="receipt-zigzag"></div>
            </div>


            <div class="flex gap-3 mt-6 w-full max-w-[380px]">
                <button
                    class="flex-1 py-3.5 rounded-xl bg-brand-blue text-white font-bold text-sm hover:bg-blue-600 transition shadow-lg hover:shadow-xl hover:-translate-y-1 flex items-center justify-center gap-2">
                    <i class="fas fa-download"></i> Download PDF
                </button>
                <button onclick="closeReceipt()"
                    class="w-12 h-12 rounded-xl bg-white text-slate-900 font-bold text-lg hover:bg-slate-50 transition shadow-lg hover:shadow-xl hover:-translate-y-1 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>


    <div id="qr-modal"
        class="fixed inset-0 z-[100] hidden items-center justify-center p-6 bg-slate-900/90 backdrop-blur-md transition-opacity opacity-0">
        <div class="bg-black/80 rounded-[2rem] max-w-sm w-full p-8 shadow-2xl transform scale-95 transition-transform duration-300 relative border border-white/10"
            id="qr-content">
            <button onclick="toggleQRModal()" class="absolute top-4 right-4 text-white hover:text-gray-300"><i
                    class="fas fa-times text-xl"></i></button>
            <div class="text-center">
                <h3 class="font-display font-bold text-xl text-white mb-6">Scan Receipt QR</h3>
                <div
                    class="w-64 h-64 mx-auto bg-slate-800 rounded-2xl relative overflow-hidden border-2 border-brand-blue shadow-neon">
                    <div
                        class="absolute inset-0 bg-[url('https://media.istockphoto.com/id/134129816/photo/qr-code.jpg?s=612x612&w=0&k=20&c=0K6v9i6y_0y6y_0y6y_0y6y_0y6y_0y6y')] bg-cover opacity-20">
                    </div>

                    <div
                        class="absolute top-0 left-0 w-full h-1 bg-brand-blue shadow-[0_0_20px_rgba(37,99,235,1)] animate-[float_3s_ease-in-out_infinite]">
                    </div>
                    <p
                        class="absolute inset-0 flex items-center justify-center text-xs text-brand-blue font-bold tracking-widest uppercase">
                        Scanning...</p>
                </div>
                <p class="text-slate-400 text-sm mt-6">Align the QR code within the frame to automatically add warranty.
                </p>
            </div>
        </div>
    </div>

    <!-- Campaign Modal -->
    <div id="campaign-modal"
        class="fixed inset-0 z-[100] hidden items-center justify-center p-6 bg-slate-900/80 backdrop-blur-sm transition-opacity opacity-0"
        onclick="if(event.target === this) closeCampaignModal()">
        <div
            class="bg-white dark:bg-slate-800 w-full max-w-md rounded-[2rem] overflow-hidden shadow-2xl animate-pop border border-slate-200 dark:border-slate-700">
            <div class="p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-slate-900 dark:text-white">Run New Campaign</h2>
                    <button onclick="closeCampaignModal()" class="text-slate-400 hover:text-slate-600 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <form id="campaign-form" onsubmit="submitCampaign(event)" class="space-y-4">
                    <div>
                        <label
                            class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Campaign
                            Title</label>
                        <input type="text" id="campaign-title" class="auth-input" placeholder="e.g. Summer Flash Sale"
                            required>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Offer
                            Description</label>
                        <textarea id="campaign-desc"
                            class="auth-input min-h-[100px] py-3 shadow-none focus:ring-1 focus:ring-blue-500"
                            placeholder="Describe your offer..." required></textarea>
                    </div>
                    <div>
                        <label
                            class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Discount
                            / Offer Label</label>
                        <input type="text" id="campaign-discount" class="auth-input"
                            placeholder="e.g. 20% OFF or Buy 1 Get 1" required>
                    </div>
                    <div class="pt-4">
                        <button type="submit" class="auth-submit-btn" id="campaign-submit-btn">
                            Launch Campaign
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- PROFILE VIEW -->
    <div id="profile-view" class="pt-28 px-6 min-h-screen fade-in hidden bg-white dark:bg-slate-900">
        <div class="max-w-3xl mx-auto">
            <div class="mb-10 text-center md:text-left reveal">
                <h2 class="font-display font-bold text-3xl text-slate-900 dark:text-white mb-2">My Profile</h2>
                <p class="text-slate-500 dark:text-slate-400 text-sm">Manage your personal information and
                    preferences.</p>
            </div>

            <div
                class="bg-white dark:bg-slate-800 rounded-[2rem] border border-slate-100 dark:border-slate-700 shadow-xl overflow-hidden reveal">
                <div class="p-8">
                    <div class="flex flex-col md:flex-row gap-8 items-center md:items-start mb-10">
                        <!-- Profile Image Section -->
                        <div class="relative group reveal">
                            <div
                                class="w-32 h-32 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-slate-700 dark:to-slate-600 flex items-center justify-center text-3xl font-bold text-brand-blue shadow-inner overflow-hidden border-4 border-white dark:border-slate-700">
                                <span id="profile-initials-large">HG</span>
                                <img id="profile-img-preview"
                                    src="https://ui-avatars.com/api/?name=H+G&background=random"
                                    class="absolute inset-0 w-full h-full object-cover">
                            </div>
                            <button onclick="document.getElementById('profile-img-file').click()"
                                class="absolute bottom-0 right-0 w-10 h-10 bg-brand-blue text-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition cursor-pointer">
                                <i class="fas fa-camera"></i>
                            </button>
                            <input type="file" id="profile-img-file" accept="image/*" class="hidden"
                                onchange="window.handleProfilePicSelect(event)">
                        </div>

                        <div class="flex-1 w-full space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-2 reveal">
                                    <label class="text-xs font-bold uppercase tracking-wider text-slate-400">Full
                                        Name</label>
                                    <input type="text" id="profile-name-input" placeholder="e.g. John Doe"
                                        class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 outline-none focus:border-brand-blue transition">
                                </div>
                                <div class="space-y-2 reveal">
                                    <label class="text-xs font-bold uppercase tracking-wider text-slate-400">Email
                                        Address</label>
                                    <input type="email" id="profile-email-input" placeholder="name@example.com"
                                        class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 outline-none focus:border-brand-blue transition">
                                </div>
                            </div>

                            <div class="space-y-2 reveal">
                                <div class="flex justify-between items-center">
                                    <label class="text-xs font-bold uppercase tracking-wider text-slate-400">Profile
                                        Picture URL</label>
                                    <button
                                        onclick="document.getElementById('profile-img-input').value=''; document.getElementById('profile-img-input').dispatchEvent(new Event('input'))"
                                        class="text-[10px] text-brand-blue hover:underline font-bold">Clear / Use
                                        Initials</button>
                                </div>
                                <div class="relative">
                                    <input type="text" id="profile-img-input"
                                        placeholder="https://images.unsplash.com/photo..."
                                        class="w-full pl-11 pr-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 outline-none focus:border-brand-blue transition">
                                    <div class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
                                        <i class="fas fa-link"></i>
                                    </div>
                                </div>
                                <p class="text-[10px] text-slate-400">Provide an image URL to override the default
                                    name initials.</p>
                            </div>

                            <div class="space-y-2 reveal">
                                <label class="text-xs font-bold uppercase tracking-wider text-slate-400">Bio</label>
                                <textarea id="profile-bio-input" rows="3" placeholder="Tell us about yourself..."
                                    class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 outline-none focus:border-brand-blue transition resize-none"></textarea>
                            </div>
                        </div>
                    </div>

                    <div
                        class="pt-8 border-t border-slate-100 dark:border-slate-700 flex flex-col md:flex-row gap-4 justify-between items-center reveal">
                        <div class="text-xs text-slate-400 text-center md:text-left">
                            <p>Last login: Today at 02:45 PM</p>
                            <p>Member since: December 2023</p>
                        </div>
                        <button onclick="saveProfile()" id="profile-save-btn"
                            class="w-full md:w-auto px-10 py-4 bg-brand-blue text-white rounded-xl font-bold transition-all shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50 hover:-translate-y-1">
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Snapshot -->
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div
                    class="p-6 rounded-[2rem] bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 flex items-center gap-4 reveal">
                    <div
                        class="w-12 h-12 rounded-2xl bg-slate-50 dark:bg-slate-700 flex items-center justify-center text-slate-600 dark:text-slate-300">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-slate-900 dark:text-white">Security</h4>
                        <p class="text-xs text-slate-500">2FA is currently <span
                                class="text-green-500 font-bold">Enabled</span></p>
                    </div>
                </div>
                <div
                    class="p-6 rounded-[2rem] bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 flex items-center gap-4 reveal">
                    <div
                        class="w-12 h-12 rounded-2xl bg-slate-50 dark:bg-slate-700 flex items-center justify-center text-slate-600 dark:text-slate-300">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-slate-900 dark:text-white">Payment</h4>
                        <p class="text-xs text-slate-500">Next billing: <span class="font-bold">Mar 15, 2024</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";
        import {
            getAuth,
            onAuthStateChanged,
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            sendEmailVerification,
            sendPasswordResetEmail,
            signOut
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        // Firestore disabled for now
        import {
            initializeFirestore,
            collection,
            addDoc,
            onSnapshot,
            query,
            where,
            orderBy,
            doc,
            getDoc,
            getDocs,
            setDoc,
            updateDoc,
            deleteDoc,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import {
            getStorage, ref, uploadBytesResumable,
            getDownloadURL, deleteObject
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBYcpZNZ40tbRTRtgB4QgfAiYPzhYDR9YU",
            authDomain: "dukaan-saathii.firebaseapp.com",
            projectId: "dukaan-saathii",
            storageBucket: "dukaan-saathii.firebasestorage.app",
            messagingSenderId: "817314618916",
            appId: "1:817314618916:web:ca7cb11b67c57411abc2b1",
            measurementId: "G-EBQ7N0QNXB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Use long polling to prevent file:// protocol and ad-blocker connection drops
        const db = initializeFirestore(app, {
            experimentalForceLongPolling: true
        });
        const storage = getStorage(app);

        // Expose to global scope for use in other <script> blocks
        window._fbAuth = auth;
        window._fbDb = db;
        window._fbStorage = storage;
        window.auth = auth;
        window.db = db;
        window.storage = storage;
        window.addDoc = addDoc;
        window.collection = collection;
        window.serverTimestamp = serverTimestamp;
        window.query = query;
        window.orderBy = orderBy;
        window.onSnapshot = onSnapshot;
        window.getDoc = getDoc;
        window.getDocs = getDocs;
        window.setDoc = setDoc;
        window.updateDoc = updateDoc;
        window.doc = doc;
        window.where = where;
        window.deleteDoc = deleteDoc;
        window.ref = ref;
        window.uploadBytesResumable = uploadBytesResumable;
        window.getDownloadURL = getDownloadURL;
        window.deleteObject = deleteObject;

        // Use device language for auth emails (reset password, etc.)
        auth.useDeviceLanguage();

        // Wrap analytics in try-catch to prevent ad-blockers from stopping script execution
        let analytics;
        try {
            analytics = getAnalytics(app);
        } catch (e) {
            console.warn("Firebase Analytics failed to initialize:", e);
        }
        // const db = getFirestore(app);

        // ===== AUTH SYSTEM =====
        window.authSelectedRole = 'merchant'; // Default
        window.authIsSignup = false;

        window.selectAuthRole = function (role) {
            window.authSelectedRole = role;
            document.getElementById('auth-role-customer').classList.remove('selected');
            document.getElementById('auth-role-merchant').classList.remove('selected');
            document.getElementById('auth-role-' + role).classList.add('selected');

            if (role === 'customer') {
                document.getElementById('auth-role-icon').innerHTML = '<i class="fas fa-user"></i>';
                document.getElementById('auth-role-label').innerText = 'Customer Portal';
            } else {
                document.getElementById('auth-role-icon').innerHTML = '<i class="fas fa-store"></i>';
                document.getElementById('auth-role-label').innerText = 'Merchant Portal';
            }

            window.authIsSignup = false;
            updateAuthFormMode();
        };

        window.toggleAuthMode = function () {
            window.authIsSignup = !window.authIsSignup;
            updateAuthFormMode();
        };

        window.toggleForgotMode = function (show) {
            const stepForm = document.getElementById('auth-step-form');
            const forgotView = document.getElementById('auth-forgot-view');
            const forgotEmailInput = document.getElementById('auth-forgot-email');
            const loginEmailInput = document.getElementById('auth-email');

            if (show) {
                stepForm.classList.add('hidden');
                forgotView.classList.remove('hidden');
                // Pre-fill email if possible
                if (loginEmailInput.value) {
                    forgotEmailInput.value = loginEmailInput.value;
                }
            } else {
                stepForm.classList.remove('hidden');
                forgotView.classList.add('hidden');
                document.getElementById('forgot-success-msg').classList.add('hidden');
            }
        };

        function updateAuthFormMode() {
            const nameField = document.getElementById('auth-name-field');
            const submitBtn = document.getElementById('auth-submit-btn');
            const toggleText = document.getElementById('auth-toggle-text');
            const toggleBtn = document.getElementById('auth-toggle-btn');
            const formTitle = document.getElementById('auth-form-title');
            const formDesc = document.getElementById('auth-form-desc');
            const forgotLink = document.getElementById('auth-forgot-link-container');

            if (window.authIsSignup) {
                nameField.classList.remove('hidden');
                submitBtn.innerText = 'Create Account';
                toggleText.innerText = 'Already have an account?';
                toggleBtn.innerText = 'Login';
                formTitle.innerText = 'Create your account';
                formDesc.innerText = 'Fill in your details to get started';
                if (forgotLink) forgotLink.classList.add('hidden');
            } else {
                nameField.classList.add('hidden');
                submitBtn.innerText = 'Login';
                toggleText.innerText = "Don't have an account?";
                toggleBtn.innerText = 'Sign Up';
                formTitle.innerText = 'Login to your account';
                formDesc.innerText = 'Enter your details to continue';
                if (forgotLink) forgotLink.classList.remove('hidden');
            }
        }

        window.handleForgotPasswordSubmit = async function (e) {
            e.preventDefault();
            const email = document.getElementById('auth-forgot-email').value.trim();
            const btn = document.getElementById('auth-forgot-submit-btn');
            const originalText = btn.innerText;

            if (!email) {
                alert("Please enter your email.");
                return;
            }

            btn.disabled = true;
            btn.innerText = "Sending...";

            try {
                await sendPasswordResetEmail(auth, email);
                document.getElementById('forgot-success-msg').classList.remove('hidden');
                btn.innerText = "Sent!";
                btn.classList.add('bg-green-600');

                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.classList.remove('bg-green-600');
                    btn.disabled = false;
                }, 3000);
            } catch (error) {
                console.error("Forgot password error:", error);
                alert("Error: " + error.message);
                btn.disabled = false;
                btn.innerText = originalText;
            }
        };

        window.handleAuthSubmit = async function (e) {
            e.preventDefault();

            const email = document.getElementById('auth-email').value.trim();
            const password = document.getElementById('auth-password').value.trim();
            const name = document.getElementById('auth-name').value.trim();
            const submitBtn = document.getElementById('auth-submit-btn');

            if (!email || !password) {
                alert('Please fill all fields.');
                return;
            }

            if (window.authIsSignup && !name) {
                alert('Please enter your name.');
                return;
            }

            submitBtn.disabled = true;
            const originalText = submitBtn.innerText;
            submitBtn.innerText = window.authIsSignup ? 'Creating...' : 'Logging in...';

            try {
                // Store role early to prevent race condition in onAuthStateChanged
                localStorage.setItem('localbridge_role', window.authSelectedRole);

                if (window.authIsSignup) {
                    // Sign Up
                    const cred = await createUserWithEmailAndPassword(auth, email, password);
                    // Save UID immediately to localStorage
                    const existingAuth = JSON.parse(localStorage.getItem('localbridge_auth') || '{}');
                    existingAuth.uid = cred.user.uid;
                    existingAuth.email = email;
                    existingAuth.name = name || email.split('@')[0];
                    existingAuth.loggedIn = true;
                    localStorage.setItem('localbridge_auth', JSON.stringify(existingAuth));
                } else {
                    // Sign In
                    const cred = await signInWithEmailAndPassword(auth, email, password);
                    // Save UID immediately to localStorage
                    const existingAuth = JSON.parse(localStorage.getItem('localbridge_auth') || '{}');
                    existingAuth.uid = cred.user.uid;
                    existingAuth.email = email;
                    existingAuth.loggedIn = true;
                    localStorage.setItem('localbridge_auth', JSON.stringify(existingAuth));
                }
            } catch (error) {
                console.error("Authentication full error object:", error);
                const errorCode = error.code;
                const errorMessage = error.message;

                if (window.authIsSignup) {
                    if (errorCode === 'auth/email-already-in-use') {
                        alert('User already exists. Please sign in');
                    } else {
                        alert('Sign-up error: ' + errorMessage);
                    }
                } else {
                    // Diagnostic Sign-in errors
                    if (errorCode === 'auth/user-not-found') {
                        alert('Error: Account not found in this project. Please click "Sign Up" to create your new account.');
                    } else if (errorCode === 'auth/wrong-password' || errorCode === 'auth/invalid-credential') {
                        alert('Error: Incorrect password for this account. Please verify or reset your password.');
                    } else {
                        alert('Sign-in error (' + errorCode + '): ' + errorMessage + '\n\nPlease try signing up again if this account was created in the old project.');
                    }
                }
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerText = originalText;
            }
        };

        window.authSignOut = async function () {
            try {
                await signOut(auth);
                localStorage.removeItem('localbridge_role');
                localStorage.removeItem('localbridge_display_name');
                location.reload();
            } catch (error) {
                alert('Error signing out: ' + error.message);
            }
        };

        // ===== MY FILES SYSTEM =====

        // Generic Modal Toggle
        window.toggleModal = (id, show) => {
            const modal = document.getElementById(id);
            if (!modal) return;
            if (show) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    const content = modal.querySelector('.animate-zoom-in');
                    if (content) content.classList.add('reveal');
                }, 10);
            } else {
                modal.classList.add('hidden');
            }
        };

        // CRUD: Folders
        window.handleNewFolderSubmit = async (e) => {
            e.preventDefault();
            const uid = window.getAuthUid();
            if (!uid) return showToast("Not authenticated", "error");

            const nameInput = document.getElementById('input-folder-name');
            const name = nameInput ? nameInput.value.trim() : "";
            if (!name) return showToast("Please enter a folder name", "error");

            const btn = e.submitter || document.getElementById('btn-create-folder');
            const originalText = btn ? btn.innerText : "Create Folder";
            if (btn) {
                btn.disabled = true;
                btn.innerText = "Creating...";
            }

            try {
                await addDoc(collection(db, "users", uid, "folders"), {
                    name,
                    createdAt: serverTimestamp()
                });
                toggleModal('modal-new-folder', false);
                if (nameInput) nameInput.value = '';
                showToast("Folder created!", "success");
            } catch (err) {
                console.error(err);
                showToast("Error creating folder", "error");
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            }
        };

        // CRUD: Files (Real Upload to Storage + Firestore)
        window.handleNewFileSubmit = async (e) => {
            e.preventDefault();
            const uid = window.getAuthUid();
            if (!uid) return showToast("Not authenticated", "error");

            const fileInput = document.getElementById('input-file-upload');
            const folderId = document.getElementById('select-file-folder').value;
            const errorEl = document.getElementById('upload-error');
            const progressBar = document.getElementById('upload-progress-bar');
            const progressText = document.getElementById('upload-progress-text');
            const progressContainer = document.getElementById('upload-progress-container');
            const btn = document.getElementById('btn-upload-file');

            if (errorEl) errorEl.classList.add('hidden');

            if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
                if (errorEl) { errorEl.textContent = 'Please select a file to upload.'; errorEl.classList.remove('hidden'); }
                return;
            }

            const file = fileInput.files[0];
            if (file.size > 50 * 1024 * 1024) {
                if (errorEl) { errorEl.textContent = 'File too large. Max 50 MB.'; errorEl.classList.remove('hidden'); }
                return;
            }

            if (btn) { btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...'; }
            if (progressContainer) progressContainer.classList.remove('hidden');

            const fileId = Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
            const storagePath = `user_uploads/${uid}/${fileId}-${file.name}`;
            const storageRef = ref(storage, storagePath);
            const uploadTask = uploadBytesResumable(storageRef, file);

            uploadTask.on('state_changed',
                (snapshot) => {
                    const pct = Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100);
                    if (progressBar) progressBar.style.width = pct + '%';
                    if (progressText) progressText.textContent = pct + '%';
                },
                (error) => {
                    console.error('Upload error:', error);
                    if (errorEl) { errorEl.textContent = 'Upload failed: ' + error.message; errorEl.classList.remove('hidden'); }
                    if (btn) { btn.disabled = false; btn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Upload File'; }
                    if (progressContainer) progressContainer.classList.add('hidden');
                },
                async () => {
                    try {
                        const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                        const sizeStr = file.size < 1024 ? file.size + ' B'
                            : file.size < 1024 * 1024 ? (file.size / 1024).toFixed(1) + ' KB'
                                : (file.size / (1024 * 1024)).toFixed(1) + ' MB';

                        await addDoc(collection(db, "users", uid, "files"), {
                            name: file.name,
                            storagePath: storagePath,
                            downloadURL: downloadURL,
                            size: sizeStr,
                            type: file.type || 'unknown',
                            folderId: folderId || '',
                            createdAt: serverTimestamp()
                        });

                        toggleModal('modal-add-file', false);
                        showToast('File uploaded successfully!', 'success');

                        // Reset modal state
                        fileInput.value = '';
                        const label = document.getElementById('file-drop-label');
                        if (label) label.textContent = 'Click to choose a file';
                        if (progressContainer) progressContainer.classList.add('hidden');
                        if (progressBar) progressBar.style.width = '0%';
                        if (progressText) progressText.textContent = '0%';
                    } catch (err) {
                        console.error('Firestore save error:', err);
                        if (errorEl) { errorEl.textContent = 'File uploaded but metadata save failed.'; errorEl.classList.remove('hidden'); }
                    } finally {
                        if (btn) { btn.disabled = false; btn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Upload File'; }
                    }
                }
            );
        };

        // Download file helper
        window.downloadFile = (url) => {
            if (!url) return showToast('No download URL available', 'error');
            window.open(url, '_blank');
        };

        // Delete file from Storage + Firestore
        window.deleteFileWithStorage = async (fileId, storagePath) => {
            const uid = window.getAuthUid();
            if (!uid) return showToast('Not authenticated', 'error');

            try {
                // Delete from Storage first
                if (storagePath) {
                    try {
                        await deleteObject(ref(storage, storagePath));
                    } catch (storageErr) {
                        console.warn('Storage delete failed (file may not exist):', storageErr);
                    }
                }
                // Delete Firestore metadata
                await deleteDoc(doc(db, `users/${uid}/files`, fileId));
                showToast('File deleted!', 'success');
            } catch (err) {
                console.error('Delete error:', err);
                showToast('Error deleting file', 'error');
            }
        };

        // CRUD: Notes
        window.handleNewNoteSubmit = async (e) => {
            e.preventDefault();
            const uid = window.getAuthUid();
            if (!uid) return showToast("Not authenticated", "error");

            const title = document.getElementById('input-note-title').value;
            const content = document.getElementById('input-note-content').value;

            try {
                await addDoc(collection(db, "users", uid, "notes"), {
                    title,
                    content,
                    createdAt: serverTimestamp()
                });
                toggleModal('modal-new-note', false);
                e.target.reset();
                showToast("Note saved!", "success");
            } catch (err) {
                console.error(err);
                showToast("Error saving note", "error");
            }
        };

        // CRUD: Team Members
        window.handleNewMemberSubmit = async (e) => {
            e.preventDefault();
            const uid = window.getAuthUid();
            if (!uid) return showToast("Not authenticated", "error");

            const name = document.getElementById('input-member-name').value;
            const role = document.getElementById('input-member-role').value;

            try {
                await addDoc(collection(db, "users", uid, "teamMembers"), {
                    name,
                    role,
                    createdAt: serverTimestamp()
                });
                toggleModal('modal-add-member', false);
                e.target.reset();
                showToast("Member added!", "success");
            } catch (err) {
                console.error(err);
                showToast("Error adding member", "error");
            }
        };

        // Deletion Helper
        window.deleteDocument = async (coll, id) => {
            const uid = window.getAuthUid();
            if (!uid) return showToast("Not authenticated", "error");

            try {
                let path = coll;
                if (coll === 'folders') path = `users/${uid}/folders`;
                if (coll === 'files') path = `users/${uid}/files`;
                if (coll === 'notes') path = `users/${uid}/notes`;
                if (coll === 'teamMembers' || coll === 'team') path = `users/${uid}/teamMembers`;
                if (coll === 'sales') path = `users/${uid}/sales`;

                await deleteDoc(doc(db, path, id));
                showToast("Deleted!", "success");
            } catch (err) {
                console.error(err);
                showToast("Error deleting", "error");
            }
        };

        // Real-time Sync Logic
        let syncActive = false;
        window.initMyFilesSync = () => {
            if (syncActive) return;
            const uid = window.getAuthUid();
            if (!uid) return;

            syncActive = true;

            // Sync Folders
            onSnapshot(query(collection(db, "users", uid, "folders"), orderBy("createdAt", "desc")), (snap) => {
                const foldersGrid = document.getElementById('folders-grid');
                const selectFolder = document.getElementById('select-file-folder');
                const countFolders = document.getElementById('count-folders');

                const loader = document.getElementById('folders-loading');
                if (loader) loader.classList.add('hidden');

                if (countFolders) countFolders.innerText = snap.size;

                if (foldersGrid) {
                    // Always clear existing UI cards
                    foldersGrid.querySelectorAll('.folder-card').forEach(c => c.remove());

                    if (snap.empty) {
                        const emptyState = document.getElementById('folders-empty');
                        if (emptyState) emptyState.classList.remove('hidden');
                    } else {
                        const emptyState = document.getElementById('folders-empty');
                        if (emptyState) emptyState.classList.add('hidden');

                        // Reset folder select
                        if (selectFolder) selectFolder.innerHTML = '<option value="">No Folder (Root)</option>';

                        snap.forEach(docSnap => {
                            const data = docSnap.data();
                            const card = document.createElement('div');
                            card.className = 'folder-card group bg-slate-50 dark:bg-slate-900/50 p-4 rounded-xl border border-slate-100 dark:border-slate-800 hover:border-blue-200 dark:hover:border-blue-900 transition cursor-pointer relative';
                            card.innerHTML = `
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/20 flex items-center justify-center text-blue-600">
                                        <i class="fas fa-folder text-lg"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-bold text-slate-800 dark:text-slate-200 truncate">${data.name}</p>
                                        <p class="text-[10px] text-slate-500">Asset Folder</p>
                                    </div>
                                    <button onclick="event.stopPropagation(); deleteDocument('folders', '${docSnap.id}')" class="opacity-0 group-hover:opacity-100 p-2 text-slate-400 hover:text-red-500 transition">
                                        <i class="fas fa-trash-alt text-xs"></i>
                                    </button>
                                </div>
                            `;
                            foldersGrid.appendChild(card);

                            // Update select
                            if (selectFolder) {
                                const opt = document.createElement('option');
                                opt.value = docSnap.id;
                                opt.innerText = data.name;
                                selectFolder.appendChild(opt);
                            }
                        });
                    }
                }
            });

            // Sync Files
            onSnapshot(query(collection(db, "users", uid, "files"), orderBy("createdAt", "desc")), (snap) => {
                const body = document.getElementById('files-list-body');
                const countFiles = document.getElementById('count-files');

                if (body) {
                    const loader = body.querySelector('#files-loading');
                    if (loader) loader.classList.add('hidden');

                    if (countFiles) countFiles.innerText = snap.size;

                    body.querySelectorAll('.file-row').forEach(r => r.remove());

                    if (snap.empty) {
                        const emptyState = body.querySelector('#files-empty');
                        if (emptyState) emptyState.classList.remove('hidden');
                    } else {
                        const emptyState = body.querySelector('#files-empty');
                        if (emptyState) emptyState.classList.add('hidden');

                        snap.forEach(docSnap => {
                            const data = docSnap.data();
                            const row = document.createElement('tr');
                            row.className = 'file-row hover:bg-slate-50 dark:hover:bg-slate-700/30 transition group';

                            // File type icon
                            let fileIcon = 'fa-file-alt';
                            const t = (data.type || '').toLowerCase();
                            if (t.includes('image')) fileIcon = 'fa-file-image';
                            else if (t.includes('pdf')) fileIcon = 'fa-file-pdf';
                            else if (t.includes('word') || t.includes('doc')) fileIcon = 'fa-file-word';
                            else if (t.includes('sheet') || t.includes('excel') || t.includes('csv')) fileIcon = 'fa-file-excel';
                            else if (t.includes('video')) fileIcon = 'fa-file-video';
                            else if (t.includes('audio')) fileIcon = 'fa-file-audio';
                            else if (t.includes('zip') || t.includes('rar') || t.includes('tar')) fileIcon = 'fa-file-archive';

                            const escapedPath = (data.storagePath || '').replace(/'/g, "\\'");
                            const escapedURL = (data.downloadURL || '').replace(/'/g, "\\'");

                            row.innerHTML = `
                                <td class="px-6 py-4">
                                    <div class="flex items-center gap-3">
                                        <i class="fas ${fileIcon} text-blue-400"></i>
                                        <div>
                                            <span class="font-medium text-slate-700 dark:text-slate-300 block">${data.name}</span>
                                            <span class="text-[10px] text-slate-400">${data.type || 'file'}</span>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 text-slate-500">
                                    ${data.folderId ? 'Subfolder' : 'Root'}
                                </td>
                                <td class="px-6 py-4 text-right text-slate-500 font-mono">${data.size || 'â€”'}</td>
                                <td class="px-6 py-4 text-right">
                                    <div class="flex items-center justify-end gap-2">
                                        ${data.downloadURL ? `<button onclick="downloadFile('${escapedURL}')" class="p-1.5 text-slate-400 hover:text-blue-600 transition" title="Download"><i class="fas fa-download text-xs"></i></button>` : ''}
                                        <button onclick="deleteFileWithStorage('${docSnap.id}', '${escapedPath}')" class="p-1.5 text-slate-300 hover:text-red-500 transition" title="Delete">
                                            <i class="fas fa-trash-alt text-xs"></i>
                                        </button>
                                    </div>
                                </td>
                            `;
                            body.appendChild(row);
                        });
                    }
                }
            });

            // Sync Notes
            onSnapshot(query(collection(db, "users", uid, "notes"), orderBy("createdAt", "desc")), (snap) => {
                const list = document.getElementById('notes-list');
                const countNotes = document.getElementById('count-notes');

                const loader = document.getElementById('notes-loading');
                if (loader) loader.classList.add('hidden');
                if (countNotes) countNotes.innerText = snap.size;

                if (list) {
                    list.querySelectorAll('.note-item').forEach(n => n.remove());

                    if (snap.empty) {
                        const emptyState = document.getElementById('notes-empty');
                        if (emptyState) emptyState.classList.remove('hidden');
                    } else {
                        const emptyState = document.getElementById('notes-empty');
                        if (emptyState) emptyState.classList.add('hidden');

                        snap.forEach(docSnap => {
                            const data = docSnap.data();
                            const item = document.createElement('div');
                            item.className = 'note-item p-3 bg-slate-50 dark:bg-slate-900/30 rounded-xl border border-slate-100 dark:border-slate-800 group';
                            item.innerHTML = `
                                <div class="flex justify-between items-start mb-1">
                                    <p class="text-xs font-bold text-slate-800 dark:text-slate-200">${data.title}</p>
                                    <button onclick="deleteDocument('notes', '${docSnap.id}')" class="opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500 transition">
                                        <i class="fas fa-times text-[10px]"></i>
                                    </button>
                                </div>
                                <p class="text-[10px] text-slate-500 leading-relaxed line-clamp-2">${data.content}</p>
                            `;
                            list.appendChild(item);
                        });
                    }
                }
            });

            // Sync Team
            onSnapshot(query(collection(db, "users", uid, "teamMembers"), orderBy("createdAt", "desc")), (snap) => {
                const list = document.getElementById('team-list');
                const countMembers = document.getElementById('count-members');

                const loader = document.getElementById('team-loading');
                if (loader) loader.classList.add('hidden');
                if (countMembers) countMembers.innerText = snap.size;

                if (list) {
                    list.querySelectorAll('.team-item').forEach(t => t.remove());

                    if (snap.empty) {
                        const emptyState = document.getElementById('team-empty');
                        if (emptyState) emptyState.classList.remove('hidden');
                    } else {
                        const emptyState = document.getElementById('team-empty');
                        if (emptyState) emptyState.classList.add('hidden');

                        snap.forEach(docSnap => {
                            const data = docSnap.data();
                            const item = document.createElement('div');
                            item.className = 'team-item flex items-center justify-between p-2 hover:bg-slate-50 dark:hover:bg-slate-900/50 rounded-lg group';
                            item.innerHTML = `
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-[10px] font-bold text-slate-600">
                                        ${data.name.charAt(0)}
                                    </div>
                                    <div>
                                        <p class="text-xs font-bold text-slate-800 dark:text-slate-200">${data.name}</p>
                                        <p class="text-[10px] text-slate-500">${data.role || 'Member'}</p>
                                    </div>
                                </div>
                                <button onclick="deleteDocument('teamMembers', '${docSnap.id}')" class="opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500 transition">
                                    <i class="fas fa-trash-alt text-[10px]"></i>
                                </button>
                            `;
                            list.appendChild(item);
                        });
                    }
                }
            });
        };



        // UI State Management with onAuthStateChanged
        onAuthStateChanged(auth, (user) => {
            const authScreen = document.getElementById('auth-screen');
            if (user) {
                // User is signed in
                const role = localStorage.getItem('localbridge_role') || 'customer';
                const displayName = localStorage.getItem('localbridge_display_name') || user.email.split('@')[0];

                const authData = {
                    uid: user.uid,
                    role: role,
                    email: user.email,
                    name: displayName,
                    loggedIn: true
                };

                // Animate out auth screen
                authScreen.classList.add('auth-hidden');
                setTimeout(() => {
                    authScreen.style.display = 'none';
                    // Show dashboard first, then sync data
                    // Save auth data to localStorage (including UID for file:// fallback)
                    localStorage.setItem('localbridge_auth', JSON.stringify(authData));
                    applyAuthState(authData);
                    // Initialize Firestore sync (wrapped to prevent errors from hiding dashboard)
                    try { window.loadMerchantProfile(); } catch (e) { console.error('Profile load error:', e); }
                    try { initMyFilesSync(); } catch (e) { console.error('Files sync error:', e); }
                    try { initSalesSync(); } catch (e) { console.error('Sales sync error:', e); }
                    try { initCampaignSync(); } catch (e) { console.error('Campaign sync error:', e); }
                }, 500);
            } else {
                // User is signed out OR unverified
                // (Unverified logic is handled in handleAuthSubmit but listener keeps UI safe)
                authScreen.style.display = 'flex';
                authScreen.classList.remove('auth-hidden');
                document.getElementById('customer-view').classList.add('hidden');
                document.getElementById('merchant-view').classList.add('hidden');
                document.getElementById('profile-view').classList.add('hidden');
                document.getElementById('main-nav').classList.add('hidden');

                // Reset role selection to default
                window.selectAuthRole('merchant');
            }
        });

        function applyAuthState(authData) {
            document.getElementById('main-nav').classList.remove('hidden');
            const navToggle = document.getElementById('nav-role-toggle');
            const navBadge = document.getElementById('nav-role-badge');
            const customerView = document.getElementById('customer-view');
            const merchantView = document.getElementById('merchant-view');
            const profileView = document.getElementById('profile-view');

            if (navToggle) navToggle.classList.add('hidden');
            if (navBadge) navBadge.classList.remove('hidden');

            if (authData.role === 'customer') {
                document.getElementById('nav-badge-icon').className = 'fas fa-user mr-1';
                document.getElementById('nav-badge-text').innerText = 'Customer';
                if (customerView) customerView.classList.remove('hidden');
                if (merchantView) merchantView.classList.add('hidden');
                if (profileView) profileView.classList.add('hidden');
                // Start customer offers sync
                if (typeof window.initCustomerOffersSync === 'function') {
                    window.initCustomerOffersSync();
                }
            } else {
                document.getElementById('nav-badge-icon').className = 'fas fa-store mr-1';
                document.getElementById('nav-badge-text').innerText = 'Merchant';
                if (customerView) customerView.classList.add('hidden');
                if (merchantView) merchantView.classList.remove('hidden');
                if (profileView) profileView.classList.add('hidden');
            }

            if (authData.name && typeof window.userState !== 'undefined') {
                window.userState.name = authData.name;
                window.userState.email = authData.email;
                if (typeof window.updateProfileUI === 'function') {
                    window.updateProfileUI();
                }
            }
        }
    </script>

    <script>
        window.switchView = function (view) {
            const customerView = document.getElementById('customer-view');
            const merchantView = document.getElementById('merchant-view');
            const profileView = document.getElementById('profile-view');
            const btnCustomer = document.getElementById('btn-customer');
            const btnMerchant = document.getElementById('btn-merchant');

            if (!customerView || !merchantView || !profileView) return;

            customerView.classList.add('hidden');
            merchantView.classList.add('hidden');
            profileView.classList.add('hidden');

            if (btnCustomer) {
                btnCustomer.classList.remove('bg-white', 'dark:bg-slate-700', 'text-brand-blue', 'shadow-sm');
                btnCustomer.classList.add('text-slate-500', 'dark:text-slate-400');
            }
            if (btnMerchant) {
                btnMerchant.classList.remove('bg-white', 'dark:bg-slate-700', 'text-brand-blue', 'shadow-sm');
                btnMerchant.classList.add('text-slate-500', 'dark:text-slate-400');
            }

            if (view === 'customer') {
                customerView.classList.remove('hidden');
                if (typeof window.initCustomerOffersSync === 'function') {
                    window.initCustomerOffersSync();
                }
                if (btnCustomer) {
                    btnCustomer.classList.add('bg-white', 'dark:bg-slate-700', 'text-brand-blue', 'shadow-sm');
                    btnCustomer.classList.remove('text-slate-500', 'dark:text-slate-400');
                }
            } else if (view === 'merchant') {
                merchantView.classList.remove('hidden');
                if (btnMerchant) {
                    btnMerchant.classList.add('bg-white', 'dark:bg-slate-700', 'text-brand-blue', 'shadow-sm');
                    btnMerchant.classList.remove('text-slate-500', 'dark:text-slate-400');
                }
            } else if (view === 'profile') {
                profileView.classList.remove('hidden');
                setTimeout(() => {
                    profileView.querySelectorAll('.reveal').forEach(el => el.classList.add('revealed'));
                    profileView.classList.add('revealed');
                }, 50);
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const modal = document.getElementById('receipt-modal');
        const modalContent = document.getElementById('modal-content');

        function addProductRow() {
            const container = document.getElementById('product-list-container');
            const newRow = document.createElement('div');
            newRow.className = 'product-row grid grid-cols-1 md:grid-cols-12 gap-4 items-end animate-fade-in group mt-4';
            newRow.innerHTML = `
    <div class="md:col-span-6">
        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Product Name</label>
        <input type="text"
            class="product-name block w-full text-sm border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-2.5 border font-mono transition bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white"
            placeholder="e.g. AirPods Pro">
    </div>
    <div class="md:col-span-3">
        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Price (â‚¹)</label>
        <div class="relative">
            <span
                class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400 text-sm">â‚¹</span>
            <input type="number" oninput="calculateTotal()"
                class="product-price block w-full pl-7 text-sm border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-2.5 border font-mono transition bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white"
                placeholder="0.00">
        </div>
    </div>
    <div class="md:col-span-2">
        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Qty</label>
        <input type="number" oninput="calculateTotal()" value="1" min="1"
            class="product-qty block w-full text-sm border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 p-2.5 border font-mono transition bg-gray-50 dark:bg-slate-900 dark:border-slate-600 dark:text-white">
    </div>
    <div class="md:col-span-1 pb-1 flex justify-center">
        <button type="button" onclick="removeProductRow(this)"
            class="text-slate-300 hover:text-red-500 transition-colors p-2">
            <i class="fas fa-trash-alt"></i>
        </button>
    </div>
    `;
            container.appendChild(newRow);
        }

        function removeProductRow(btn) {
            const rows = document.querySelectorAll('.product-row');
            if (rows.length > 1) {
                btn.closest('.product-row').remove();
                calculateTotal();
            } else {
                showToast("At least one product is required.", "info");
            }
        }

        function calculateTotal() {
            let total = 0;
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                const price = parseFloat(row.querySelector('.product-price').value) || 0;
                const qty = parseInt(row.querySelector('.product-qty').value) || 1;
                total += price * qty;
            });
            document.getElementById('sale-total-display').innerText = `â‚¹${total.toLocaleString(undefined, {
                minimumFractionDigits: 2, maximumFractionDigits: 2
            })}`;
            document.getElementById('sale-amount').value = total;
        }

        function openReceipt(products, shop, total) {
            const container = document.getElementById('modal-items-container');
            container.innerHTML = ''; // Clear previous

            products.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'flex justify-between items-start mb-4';
                const itemTotal = parseFloat(item.price) * parseInt(item.qty);
                itemEl.innerHTML = `
    <div>
        <p class="font-bold text-slate-900 text-base mb-1">${item.name}</p>
        <p class="text-xs text-slate-500">${item.qty} x â‚¹${parseFloat(item.price).toLocaleString()}</p>
    </div>
    <span class="font-bold text-slate-900 text-base">â‚¹${itemTotal.toLocaleString(undefined, {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                })}</span>
    `;
                container.appendChild(itemEl);
            });

            document.getElementById('modal-shop').innerText = shop;
            document.getElementById('modal-subtotal').innerText = `â‚¹${parseFloat(total).toLocaleString(undefined, {
                minimumFractionDigits: 2, maximumFractionDigits: 2
            })}`;
            document.getElementById('modal-tax').innerText = "â‚¹0.00 (Inclusive)";
            document.getElementById('modal-total').innerText = `â‚¹${parseFloat(total).toLocaleString(undefined, {
                minimumFractionDigits: 2, maximumFractionDigits: 2
            })}`;

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
            }, 10);
        }

        function closeReceipt() {
            modal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }


        const qrModal = document.getElementById('qr-modal');
        const qrContent = document.getElementById('qr-content');
        function toggleQRModal() {
            if (qrModal.classList.contains('hidden')) {
                qrModal.classList.remove('hidden');
                setTimeout(() => { qrModal.classList.remove('opacity-0'); qrContent.classList.remove('scale-95'); }, 10);
            } else {
                qrModal.classList.add('opacity-0');
                qrContent.classList.add('scale-95');
                setTimeout(() => { qrModal.classList.add('hidden'); }, 300);
            }
        }


        function toggleNotifications() {
            const dropdown = document.getElementById('notif-dropdown');
            dropdown.classList.toggle('hidden');
            // Close profile dropdown if open
            document.getElementById('profile-dropdown').classList.add('hidden');
        }

        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profile-dropdown');
            dropdown.classList.toggle('hidden');
            // Close notifications if open
            document.getElementById('notif-dropdown').classList.add('hidden');
        }

        // Close dropdowns when clicking outside
        window.addEventListener('click', (e) => {
            if (!e.target.closest('#nav-avatar-img') && !e.target.closest('#nav-avatar-initials') &&
                !e.target.closest('#profile-dropdown')) {
                document.getElementById('profile-dropdown').classList.add('hidden');
            }
            if (!e.target.closest('.far.fa-bell') && !e.target.closest('#notif-dropdown')) {
                document.getElementById('notif-dropdown').classList.add('hidden');
            }
        });


        function updatePreview() {
            const input = document.getElementById('broadcast-message').value;
            const preview = document.getElementById('preview-text');
            const count = document.getElementById('char-count');

            preview.innerText = input || "Sat Sri Akal! New stock arrived...";
            if (count) {
                count.innerText = `${input.length}/160`;
                if (input.length > 160) {
                    count.classList.add('text-red-500');
                    count.classList.remove('text-blue-600');
                } else {
                    count.classList.remove('text-red-500');
                    count.classList.add('text-blue-600');
                }
            }
        }


        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('dark-icon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        }

        // --- TOAST SYSTEM ---
        function showToast(message, type = 'info') {
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'toast-container';
                document.body.appendChild(container);
            }

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';

            toast.innerHTML = `
    <i
        class="fas ${icon} ${type === 'success' ? 'text-green-500' : type === 'error' ? 'text-red-500' : 'text-blue-500'}"></i>
    <span>${message}</span>
    `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'toast-out 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards';
                setTimeout(() => {
                    toast.remove();
                    if (container.childNodes.length === 0) {
                        container.remove();
                    }
                }, 300);
            }, 3000);
        }

        function sendBill(mobile, name, products, total, customerEmail) {
            const keysRaw = localStorage.getItem('localbridge_api_keys');
            const keys = keysRaw ? JSON.parse(keysRaw) : null;
            const merchantEmail = (typeof userState !== 'undefined' && userState.email) ? userState.email :
                "merchant@example.com";

            // Primary recipient is customerEmail if provided, otherwise merchantEmail fallback
            const recipientEmail = (customerEmail && customerEmail.includes('@')) ? customerEmail : merchantEmail;

            if (!recipientEmail || recipientEmail.trim() === "" || recipientEmail === "merchant@example.com") {
                console.warn('No valid recipient email found. Falling back to simulation.');
            }

            if (!keys || !keys.emailjs?.service || !keys.emailjs?.template || !keys.emailjs?.public) {
                showToast("Real sending disabled: Configure API keys in Settings.", "info");
                showToast(`Simulation: Bill for â‚¹${parseFloat(total).toLocaleString()} sent to +91 ${mobile}.`, 'success');
                return;
            }

            // Enhanced validation error
            if (!recipientEmail || !recipientEmail.includes('@')) {
                showToast("Error: No valid recipient email address found!", "error");
                return;
            }

            showToast(`Targeting email: ${recipientEmail}...`, 'info');
            showToast(`Using Template: ${keys.emailjs.template}`, 'info');
            showToast(`Using Service: ${keys.emailjs.service}`, 'info');

            // 1. Actual Email sending via EmailJS
            const orderId = 'TRX-' + Math.floor(Math.random() * 9000 + 1000);

            // Format total for nested cost object
            const numTotal = parseFloat(total) || 0;
            const formattedTotal = `${numTotal.toLocaleString(undefined, {
                minimumFractionDigits: 2, maximumFractionDigits: 2
            })}`;

            // Construct orders array for EmailJS template loop
            const emailOrders = products.map(item => ({
                name: item.name,
                units: 1,
                price: `â‚¹${parseFloat(item.price).toLocaleString(undefined, {
                    minimumFractionDigits: 2, maximumFractionDigits: 2
                })}`
            }));

            const emailParams = {
                email: recipientEmail, // Recipient email
                order_id: orderId, // Transaction ID

                // Line Items array (Handlebars {{#orders}} ... {{/orders}})
                orders: emailOrders,

                // Nested Cost object (Handlebars {{cost.total}}, etc.)
                cost: {
                    shipping: "â‚¹0.00",
                    tax: "â‚¹0.00 (Inclusive)",
                    total: `â‚¹${formattedTotal}`
                },

                // Backup variables for other possible templates
                to_email: recipientEmail,
                customer_name: name,
                customer_mobile: mobile,
                product_summary: products.map(p => p.name).join(', '),
                amount: `â‚¹${formattedTotal}`,
                shop_name: "LocalBridge Merchant"
            };

            console.log('Sending Multi-Product Email - Recipient:', recipientEmail);
            console.log('Final Template Params:', JSON.stringify(emailParams, null, 2));

            if (typeof emailjs === 'undefined') {
                console.error('EmailJS SDK not loaded!');
                showToast("EmailJS SDK failed to load.", "error");
                return;
            }

            emailjs.send(keys.emailjs.service, keys.emailjs.template, emailParams, keys.emailjs.public)
                .then(function (response) {
                    console.log('EmailJS Success:', response.status, response.text);
                    showToast("Digital Bill sent successfully!", "success");
                }, function (error) {
                    console.error('EmailJS Error:', error);
                    showToast("Email failed to deliver. Check logs.", "error");
                });

            // 2. WhatsApp Logic (100% Automated Background Send via Ultramsg)
            const productList = products.map(p => `${p.name} x${p.qty}`).join(', ');
            const waBody = `*ORDER BILL* ðŸ“„\n\nHi ${name},\nYour bill for *${productList}* is
    *â‚¹${numTotal.toLocaleString()}*.\n\nThank you for shopping with us!\nLocalBridge Merchant`;

            if (keys.whatsapp?.instance && keys.whatsapp?.token) {
                showToast(`Sending automated WhatsApp bill...`, 'info');

                // Sanitizing number for Ultramsg (needs numeric, international e.g. 91...)
                let waTarget = mobile.replace(/\D/g, '');
                if (waTarget.length === 10) waTarget = `91${waTarget}`;

                const waUrl =
                    `https://api.ultramsg.com/${keys.whatsapp.instance}/messages/chat?token=${keys.whatsapp.token}&to=${waTarget}&body=${encodeURIComponent(waBody)}`;

                // Background trigger
                fetch(waUrl, { mode: 'no-cors' })
                    .then(() => {
                        console.log('Ultramsg WhatsApp signal sent successfully.');
                        showToast(`WhatsApp bill sent automatically!`, 'success');
                    })
                    .catch(err => {
                        console.error('WhatsApp Automation Error:', err);
                        showToast("WhatsApp delivery failed. Check instance/token.", "error");
                    });
            } else {
                showToast("WhatsApp Automation not configured in Settings.", "info");
            }
        }


        window.registerSale = async (event) => {
            const uid = window.getAuthUid();
            if (!uid) return showToast("Not authenticated", "error");

            const name = document.getElementById('sale-name').value || "Walk-in Customer";
            const mobile = document.getElementById('sale-mobile').value;
            const customerEmail = document.getElementById('sale-email').value.trim();
            const warranty = document.getElementById('sale-warranty').value;
            const returnPolicy = document.getElementById('sale-return').value;
            const paymentStatus = document.getElementById('sale-status').value;

            // Collect products
            const products = [];
            const rows = document.querySelectorAll('.product-row');
            rows.forEach(row => {
                const pName = row.querySelector('.product-name').value || "Generic Product";
                const pPrice = parseFloat(row.querySelector('.product-price').value) || 0;
                const pQty = parseInt(row.querySelector('.product-qty').value) || 1;
                products.push({ name: pName, price: pPrice, qty: pQty });
            });

            const totalAmount = parseFloat(document.getElementById('sale-amount').value) || 0;

            if (mobile.length < 10) {
                showToast("Please enter a valid 10-digit mobile number.", "error");
                return;
            }
            if (totalAmount <= 0) {
                showToast("Please add at least one product with a valid price.", "error");
                return;
            }

            const btn = event.currentTarget;
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            btn.disabled = true;

            try {
                // Save to Firestore
                await addDoc(collection(db, "users", uid, "sales"), {
                    customerName: name,
                    customerMobile: mobile,
                    customerEmail: customerEmail,
                    products: products,
                    totalAmount: totalAmount,
                    warranty: warranty,
                    returnPolicy: returnPolicy,
                    paymentStatus: paymentStatus,
                    createdAt: serverTimestamp()
                });

                showToast("Sale Logged Successfully!", "success");

                // We no longer need to manually inject into table because initSalesSync will handle it

                // Keep the receipts and other side effects
                openReceipt(products, "LocalBridge Merchant", totalAmount);
                sendBill(mobile, name, products, totalAmount, customerEmail);

                // Reset Form
                document.getElementById('sale-name').value = '';
                document.getElementById('sale-mobile').value = '';
                document.getElementById('sale-email').value = '';

                // Reset product rows
                const container = document.getElementById('product-list-container');
                container.innerHTML = `
                    <div class="product-row grid grid-cols-1 md:grid-cols-12 gap-4 items-end animate-fade-in group">
                        <div class="md:col-span-7">
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Product Name</label>
                            <input type="text" class="product-name auth-input" placeholder="Enter product name">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Price</label>
                            <input type="number" class="product-price auth-input text-right" placeholder="0" oninput="calculateTotal()">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Qty</label>
                            <input type="number" class="product-qty auth-input text-right" value="1" oninput="calculateTotal()">
                        </div>
                        <div class="md:col-span-1 py-1">
                            <button class="w-full h-10 flex items-center justify-center text-slate-300">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
                calculateTotal();

            } catch (err) {
                console.error("Firestore Error in registerSale:", err);
                const errorMsg = err.code ? `${err.code}: ${err.message}` : err.message || String(err);
                showToast("Error logging sale: " + errorMsg, "error");
            } finally {
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }
        };

        // Real-time Sales Sync
        let salesSyncActive = false;
        window.initSalesSync = () => {
            if (salesSyncActive) return;
            const uid = window.getAuthUid();
            if (!uid) return;
            salesSyncActive = true;

            onSnapshot(query(collection(db, "users", uid, "sales"), orderBy("createdAt", "desc")), (snap) => {
                const transactionsBody = document.getElementById('transactions-body');
                const ledgerBody = document.getElementById('credit-ledger-body');
                const creditCountElem = document.getElementById('total-credit-count');

                if (transactionsBody) transactionsBody.innerHTML = '';
                if (ledgerBody) ledgerBody.innerHTML = '';

                let pendingCount = 0;

                snap.forEach(docSnap => {
                    const data = docSnap.data();
                    const date = data.createdAt ? data.createdAt.toDate() : new Date();
                    const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ", " + date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    const productSummary = data.products.map(p => p.name).join(', ');

                    // Transaction Table Row
                    if (transactionsBody) {
                        const statusColor = data.paymentStatus === "Paid" ? "green" : "orange";
                        const row = document.createElement('tr');
                        row.className = `hover:bg-gray-50 dark:hover:bg-slate-700/50 transition border-l-4 ${data.paymentStatus === 'Pending' ? 'border-orange-500 bg-orange-50/10' : 'border-blue-500 bg-blue-50/10'}`;
                        row.innerHTML = `
                            <td class="px-5 py-3 font-medium text-slate-900 dark:text-white">${data.customerName} <span class="text-slate-400 text-xs font-normal">(${data.customerMobile})</span></td>
                            <td class="px-5 py-3 text-slate-600 dark:text-slate-300 font-medium truncate max-w-[200px]">${productSummary}</td>
                            <td class="px-5 py-3">
                                <span class="bg-${statusColor}-100 text-${statusColor}-700 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase border border-${statusColor}-200">${data.paymentStatus}</span>
                            </td>
                            <td class="px-5 py-3 text-slate-500 font-mono text-xs">${dateStr}</td>
                            <td class="px-5 py-3 text-slate-900 dark:text-white font-mono text-right font-bold">â‚¹${data.totalAmount.toLocaleString()}</td>
                            <td class="px-5 py-3 text-right">
                                <button onclick="deleteDocument('sales', '${docSnap.id}')" class="text-slate-300 hover:text-red-500 transition">
                                    <i class="fas fa-trash-alt text-xs"></i>
                                </button>
                            </td>
                        `;
                        transactionsBody.appendChild(row);
                    }

                    // Credit Ledger Row
                    if (data.paymentStatus === 'Pending') {
                        pendingCount++;
                        if (ledgerBody) {
                            const ledgerRow = document.createElement('tr');
                            ledgerRow.className = 'hover:bg-gray-50 dark:hover:bg-slate-700/50 transition border-l-4 border-orange-500';
                            ledgerRow.innerHTML = `
                                <td class="px-6 py-4">
                                    <p class="text-sm font-bold text-slate-900 dark:text-white">${data.customerName}</p>
                                    <p class="text-[10px] text-slate-500">+91 ${data.customerMobile}</p>
                                </td>
                                <td class="px-6 py-4 text-xs text-slate-600 dark:text-slate-400 truncate max-w-[150px]">${productSummary}</td>
                                <td class="px-6 py-4 text-xs text-slate-500">${dateStr}</td>
                                <td class="px-6 py-4 text-sm font-bold text-orange-600 text-right">â‚¹${data.totalAmount.toLocaleString()}</td>
                            `;
                            ledgerBody.appendChild(ledgerRow);
                        }
                    }
                });

                if (creditCountElem) creditCountElem.innerText = `${pendingCount} Pending`;
            });
        };



        function generateMockData() {
            const names = ["Aarav Patel", "Vihaan Rao", "Aditya Sharma", "Sai Kumar", "Reyansh Gupta", "Arjun Singh", "Kia Kapoor", "Ananya Reddy", "Ishita Verma", "Saanvi Nair", "Rohan Mehta", "Priya Das"];
            const products = ["iPhone 15 Pro", "Samsung S24 Ultra", "MacBook Air M3", "Sony WH-1000XM5", "iPad Air", "Apple Watch S9", "Marshall Emberton", "Dell XPS 13"];
            const warranties = ["6 Months", "1 Year", "2 Years", "Lifetime", "None"];
            const returns = ["3 Days", "7 Days", "30 Days", "None"];
            const statuses = ["Paid", "Paid", "Paid", "Pending"];

            const tbody = document.getElementById('transactions-body');
            tbody.innerHTML = '';

            for (let i = 0; i < 25; i++) {
                const name = names[Math.floor(Math.random() * names.length)]; const
                    product = products[Math.floor(Math.random() * products.length)]; const amount = Math.floor(Math.random() *
                        25000) + 500; let wVal = warranties[Math.floor(Math.random() * warranties.length)]; let
                            rVal = returns[Math.floor(Math.random() * returns.length)]; if (Math.random() > 0.8) {
                                wVal = "None"; rVal =
                                    "None";
                            }

                let policiesHTML = '';
                if (wVal !== "None") {
                    policiesHTML += `< span
        class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide bg-blue-100 text-blue-800 border border-blue-200 mr-1" > Warranty
            (${wVal})</span > `;
                }
                if (rVal !== "None") {
                    policiesHTML += `< span
        class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide bg-purple-100 text-purple-800 border border-purple-200" > Return
            (${rVal})</span > `;
                }
                if (wVal === "None" && rVal === "None") {
                    policiesHTML = `< span
        class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide bg-slate-100 text-slate-800 border border-slate-200" > Record
                Only</span > `;
                }

                const status = statuses[Math.floor(Math.random() * statuses.length)];
                const statusColor = status === "Paid" ? "green" : "orange";

                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 10));
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ", " +
                    date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

                const tr = document.createElement('tr');
                tr.className = `hover: bg - gray - 50 dark: hover: bg - slate - 700 / 50 transition border - b border - gray - 100
        dark: border - slate - 700 ${i >= 7 ? 'hidden extra-row' : ''} `;
                tr.innerHTML = `
            < td class="px-5 py-3 font-medium text-slate-900 dark:text-white" > ${name}</td >
            <td class="px-5 py-3 text-slate-600 dark:text-slate-400">${product}</td>
            <td class="px-5 py-3">${policiesHTML}</td>
            <td class="px-5 py-3 text-slate-500 font-mono text-xs">${dateStr}</td>
            <td class="px-5 py-3 text-slate-900 font-mono text-right font-bold">â‚¹${amount.toLocaleString()}</td>
            <td class="px-5 py-3 text-right"><span
                    class="bg-${statusColor}-100 text-${statusColor}-700 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase border border-${statusColor}-200">${status}</span>
            </td>
        `;
                tbody.appendChild(tr);
            }
        }

        function toggleViewAll() {
            const hiddenRows = document.querySelectorAll('.extra-row');
            const btn = document.getElementById('view-all-btn');
            if (hiddenRows.length === 0) return;

            const isHidden = hiddenRows[0].classList.contains('hidden');

            hiddenRows.forEach(row => {
                if (isHidden) row.classList.remove('hidden');
                else row.classList.add('hidden');
            });

            btn.innerText = isHidden ? "Show Less" : "View All";
        }


        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            if (!obj) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const value = Math.floor(progress * (end - start) + start);

                if (id === 'stat-revenue') {
                    obj.innerHTML = `â‚¹${(value / 10).toFixed(1)} L`;
                } else if (id === 'stat-aov') {
                    obj.innerHTML = `â‚¹${value.toLocaleString()} `;
                } else {
                    obj.innerHTML = value.toLocaleString();
                }

                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function showChartTooltip(event, amount) {
            const tooltip = document.getElementById('chart-tooltip');
            const container = document.getElementById('revenue-chart-container');
            if (!tooltip || !container) return;
            const rect = container.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            tooltip.innerText = amount;
            tooltip.style.left = `${x} px`;
            tooltip.style.top = `${y} px`;
            tooltip.classList.remove('hidden');
        }

        function hideChartTooltip() {
            const tooltip = document.getElementById('chart-tooltip');
            if (tooltip) tooltip.classList.add('hidden');
        }

        function updateDashboardData(range) {
            let data = {
                revenue: 124, customers: 4200, repeat: 342, aov: 3450,
                rangeLabel: "Last 30 Days", chartTitle: "Monthly Revenue Trend", points: [160, 140, 170, 110, 130, 80, 90, 40], amounts: ["â‚¹15,200", "â‚¹18,500", "â‚¹12,800", "â‚¹22,400", "â‚¹19,100", "â‚¹28,500", "â‚¹24,200", "â‚¹35,000"]
            };

            if (range === '7days') {
                data = {
                    revenue: 32, customers: 1200, repeat: 95, aov: 2800,
                    rangeLabel: "Last 7 Days", chartTitle: "Weekly Revenue Trend", points: [180, 170, 150, 160, 130, 140, 100, 110], amounts: ["â‚¹2,100", "â‚¹3,400", "â‚¹5,200", "â‚¹4,800", "â‚¹6,900", "â‚¹6,100", "â‚¹8,400", "â‚¹7,200"]
                };
            } else if (range === 'quarter') {
                data = {
                    revenue: 450, customers: 12500, repeat: 1840,
                    aov: 4100, rangeLabel: "Last Quarter", chartTitle: "Quarterly Revenue Trend", points: [120, 100, 110, 90, 70, 60, 50, 30], amounts: ["â‚¹45k", "â‚¹52k", "â‚¹48k", "â‚¹64k", "â‚¹78k", "â‚¹82k", "â‚¹95k", "â‚¹110k"]
                };
            } else if (range === 'year') {
                data = {
                    revenue: 1850, customers: 48000, repeat: 6200, aov: 3850,
                    rangeLabel: "Last Year", chartTitle: "Yearly Revenue Trend", points: [150, 160, 140, 130, 110, 90, 70, 20], amounts: ["â‚¹1.2L", "â‚¹1.1L", "â‚¹1.4L", "â‚¹1.5L", "â‚¹1.8L", "â‚¹2.2L", "â‚¹2.6L", "â‚¹3.8L"]
                };
            }

            document.getElementById('chart-title').innerText = data.chartTitle;
            document.getElementById('chart-range-label').innerText = data.rangeLabel;
            animateValue("stat-revenue", 0, data.revenue, 1000);
            animateValue("stat-customers", 0, data.customers, 1000);
            animateValue("stat-repeat-customers", 0, data.repeat, 1000);
            animateValue("stat-aov", 0, data.aov, 1000);

            const line = document.getElementById('chart-line');
            const area = document.getElementById('chart-area');
            const pointsGroup = document.getElementById('chart-points');

            if (line && area && pointsGroup) {
                let pathD = `M0, ${data.points[0]} `;
                data.points.forEach((y, i) => {
                    if (i > 0) pathD += `L${i * 100},${y} `;
                });

                line.setAttribute('d', pathD);
                area.setAttribute('d', `${pathD} L700, 200 L0, 200 Z`);

                const circles = pointsGroup.getElementsByTagName('circle');
                data.points.forEach((y, i) => {
                    if (circles[i]) {
                        circles[i].setAttribute('cy', y);
                        circles[i].setAttribute('onmouseover', `showChartTooltip(event, '${data.amounts[i]}')`);
                    }
                });
            }

            const chartContainer = document.getElementById('revenue-chart-container');
            if (chartContainer) {
                chartContainer.style.transition = 'all 0.3s ease';
                chartContainer.style.opacity = '0.5';
                setTimeout(() => {
                    chartContainer.style.opacity = '1';
                }, 300);
            }
        }

        function initDashboardStats() {
            animateValue("stat-revenue", 0, 124, 1000);
            animateValue("stat-customers", 0, 4200, 1000);
            animateValue("stat-repeat-customers", 0, 342, 1000);
            animateValue("stat-aov", 0, 3450, 1000);
        }

        generateMockData();
        initDashboardStats();



        const autoRevealSelectors = [
            '#customer-view section',
            '#customer-view > .max-w-7xl > div',
            '#merchant-view section',
            '#merchant-view > div > div',
            '#profile-view .reveal',
            '#profile-view > div > div',
            'footer',
            '.safe-shopping-section',
            'nav'
        ];
        document.querySelectorAll(autoRevealSelectors.join(', ')).forEach(el => {
            if (!el.classList.contains('reveal')) {
                el.classList.add('reveal');
            }
        });

        const revealElements = document.querySelectorAll('.reveal');

        if (revealElements.length > 0) {
            const revealObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('revealed');
                        revealObserver.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1
            });

            revealElements.forEach(el => {
                revealObserver.observe(el);
            });
        }


        (function initHeroReveal() {

            const nav = document.querySelector('nav');
            if (nav) nav.classList.add('revealed');

            const heroSection = document.querySelector('#customer-view > .max-w-7xl > section:first-child');
            if (heroSection) {

                heroSection.style.filter = 'blur(12px)';
                heroSection.style.transition = 'none';

                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        heroSection.style.transition = 'filter 1.2s cubic-bezier(0.16, 1, 0.3, 1)';
                        heroSection.style.filter = 'blur(0)';
                    });
                });
            }
        })();


        function switchMerchantTab(tabName) {
            const tabs = ['dashboard', 'new-sale', 'transactions', 'my-files', 'broadcast', 'campaigns', 'customers', 'settings'];
            tabs.forEach(tab => {
                const section = document.getElementById(`merchant-${tab}`);
                const menuItem = document.getElementById(`menu-${tab}`);
                const mobileMenuItem = document.getElementById(`mobile-menu-${tab}`);

                if (section) section.classList.add('hidden');
                if (menuItem) {
                    menuItem.classList.remove('bg-blue-50', 'text-blue-700', 'dark:bg-blue-900/20', 'dark:text-blue-400');
                    menuItem.classList.add('text-slate-600', 'dark:text-slate-400');
                }
                if (mobileMenuItem) {
                    mobileMenuItem.classList.remove('text-blue-600');
                    mobileMenuItem.classList.add('text-slate-400', 'dark:text-slate-500');
                }
            });

            const activeSection = document.getElementById(`merchant-${tabName}`);
            const activeMenuItem = document.getElementById(`menu-${tabName}`);
            const activeMobileMenuItem = document.getElementById(`mobile-menu-${tabName}`);

            if (activeSection) {
                activeSection.classList.remove('hidden');
                // Trigger reveals if dashboard
                if (tabName === 'dashboard') {
                    setTimeout(() => {
                        activeSection.querySelectorAll('.reveal').forEach(el => el.classList.add('revealed'));
                    }, 50);
                }
                // Trigger sync if my-files
                if (tabName === 'my-files' && typeof window.initMyFilesSync === 'function') {
                    window.initMyFilesSync();
                }
                // Trigger sync if campaigns
                if (tabName === 'campaigns' && typeof window.initCampaignSync === 'function') {
                    window.initCampaignSync();
                }
            }

            if (activeMenuItem) {
                activeMenuItem.classList.add('bg-blue-50', 'text-blue-700', 'dark:bg-blue-900/20', 'dark:text-blue-400');
                activeMenuItem.classList.remove('text-slate-600', 'dark:text-slate-400');
            }
            if (activeMobileMenuItem) {
                activeMobileMenuItem.classList.add('text-blue-600');
                activeMobileMenuItem.classList.remove('text-slate-400', 'dark:text-slate-500');
            }

            // Mobile more menu logic
            const allMobileTabs = ['dashboard', 'new-sale', 'transactions'];
            const moreBtn = document.getElementById('mobile-menu-more');
            if (!allMobileTabs.includes(tabName)) {
                if (moreBtn) {
                    moreBtn.classList.remove('text-slate-400', 'dark:text-slate-500');
                    moreBtn.classList.add('text-blue-600');
                }
            } else {
                if (moreBtn) {
                    moreBtn.classList.add('text-slate-400', 'dark:text-slate-500');
                    moreBtn.classList.remove('text-blue-600');
                }
            }

            closeMobileMoreMenu();
        }

        function toggleMobileMoreMenu() {
            const overlay = document.getElementById('mobile-more-overlay');
            const content = document.getElementById('more-menu-content');

            if (overlay.classList.contains('hidden')) {
                overlay.classList.remove('hidden');
                setTimeout(() => {
                    content.classList.remove('translate-y-full');
                }, 10);
            } else {
                content.classList.add('translate-y-full');
                setTimeout(() => {
                    overlay.classList.add('hidden');
                }, 300);
            }
        }

        function closeMobileMoreMenu() {
            const overlay = document.getElementById('mobile-more-overlay');
            const content = document.getElementById('more-menu-content');
            if (overlay && !overlay.classList.contains('hidden')) {
                content.classList.add('translate-y-full');
                setTimeout(() => {
                    overlay.classList.add('hidden');
                }, 300);
            }
        }


        window.createCampaign = () => {
            const modal = document.getElementById('campaign-modal');
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.replace('opacity-0', 'opacity-100');
            }, 10);
        };

        window.closeCampaignModal = () => {
            const modal = document.getElementById('campaign-modal');
            modal.classList.replace('opacity-100', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.style.display = 'none';
                document.getElementById('campaign-form').reset();
            }, 300);
        };

        window.submitCampaign = async (event) => {
            event.preventDefault();
            const uid = window.getAuthUid();
            if (!uid) return showToast("Not authenticated", "error");

            const title = document.getElementById('campaign-title').value;
            const desc = document.getElementById('campaign-desc').value;
            const discount = document.getElementById('campaign-discount').value;

            // Get merchant name from profile or auth
            const authData = JSON.parse(localStorage.getItem('localbridge_auth') || '{}');
            const merchantName = authData.name || "Local Merchant";

            const btn = document.getElementById('campaign-submit-btn');
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Launching...';
            btn.disabled = true;

            try {
                // Save to global campaigns collection
                await addDoc(collection(db, "campaigns"), {
                    merchantId: uid,
                    merchantName: merchantName,
                    title: title,
                    description: desc,
                    discount: discount,
                    status: 'active',
                    createdAt: serverTimestamp(),
                    expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // Default 7 days
                });
                console.log("submitCampaign: Document added successfully");

                showToast("Campaign Launched Successfully!", "success");
                closeCampaignModal();
            } catch (err) {
                console.error("Campaign Error:", err);
                showToast("Error launching campaign: " + err.message, "error");
            } finally {
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }
        };

        function filterCustomers() {
            const input = document.getElementById('customer-search');
            const filter = input.value.toUpperCase();
            const table = document.getElementById('credit-ledger-body');
            if (!table) return;

            const tr = table.getElementsByTagName('tr');
            for (let i = 0; i < tr.length; i++) {
                const td = tr[i].getElementsByTagName('td')[0]; if (td) {
                    const
                        txtValue = td.textContent || td.innerText; if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            tr[i].style.display = "";
                        } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }

        function filterTransactions() {
            const input = document.getElementById('transaction-search');
            const filter = input.value.toUpperCase();
            const table = document.getElementById('transactions-body');
            if (!table) return;

            const tr = table.getElementsByTagName('tr');
            for (let i = 0; i < tr.length; i++) {
                const nameCell = tr[i].getElementsByTagName('td')[0]; const
                    productCell = tr[i].getElementsByTagName('td')[1]; if (nameCell || productCell) {
                        const
                            nameText = nameCell ? (nameCell.textContent || nameCell.innerText) : ""; const
                                productText = productCell ? (productCell.textContent || productCell.innerText) : ""; if
                            (nameText.toUpperCase().indexOf(filter) > -1 || productText.toUpperCase().indexOf(filter) > -1) {
                            tr[i].style.display = "";
                        } else {
                            tr[i].style.display = "none";
                        }
                    }
            }
        }

        window.saveSettings = async () => {
            const btn = document.querySelector('button[onclick="saveSettings()"]') || event.currentTarget;
            if (!btn) return;
            const originalText = btn.innerHTML;

            // Get user UID - try Firebase Auth first, fall back to localStorage
            let uid = null;
            if (auth.currentUser) {
                uid = auth.currentUser.uid;
            } else {
                try {
                    const localAuth = JSON.parse(localStorage.getItem('localbridge_auth') || '{}');
                    uid = localAuth.uid || null;
                } catch (e) { }
            }

            if (!uid) {
                showToast("Not authenticated. Please log in again.", "error");
                return;
            }

            if (window.isUploadingPic) {
                showToast("Please wait for the image to finish uploading...", "info");
                return;
            }

            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving to Cloud...';
            btn.disabled = true;

            const profileData = {
                name: document.getElementById('set-store-name').value,
                phone: document.getElementById('set-store-phone').value,
                address: document.getElementById('set-store-address').value,
                bio: document.getElementById('set-store-bio').value,
                profilePic: document.getElementById('set-store-pic').value,
                apiKeys: {
                    emailjs: {
                        service: document.getElementById('api-emailjs-service').value,
                        template: document.getElementById('api-emailjs-template').value,
                        public: document.getElementById('api-emailjs-public').value
                    },
                    whatsapp: {
                        instance: document.getElementById('api-wa-instance').value,
                        token: document.getElementById('api-wa-token').value
                    }
                },
                updatedAt: serverTimestamp()
            };

            try {
                const result = await window.syncProfileToCloud(uid, profileData);

                if (result.success) {
                    // Re-init EmailJS if key changed
                    if (profileData.apiKeys.emailjs.public) {
                        emailjs.init(profileData.apiKeys.emailjs.public);
                    }
                    showToast("Settings Saved Successfully!", "success");
                } else {
                    throw new Error(result.error);
                }
            } catch (err) {
                console.error("Save Error:", err);
                showToast("Error saving settings: " + err.message, "error");
            } finally {
                btn.innerHTML = '<i class="fas fa-check"></i> Saved';
                btn.classList.add('bg-green-500');
                btn.disabled = false;
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-500');
                }, 2000);
            }
        };

        // Helper: get the current user UID from Firebase Auth or localStorage fallback
        window.getAuthUid = () => {
            if (auth.currentUser) return auth.currentUser.uid;
            try {
                const localAuth = JSON.parse(localStorage.getItem('localbridge_auth') || '{}');
                return localAuth.uid || null;
            } catch (e) { return null; }
        };

        window.syncProfileToCloud = async (uid, data) => {
            console.log("ðŸš€ Syncing to Cloud for UID:", uid);
            try {
                if (!window.db || !window.setDoc || !window.doc) {
                    throw new Error("Firebase not initialized yet. Please wait a moment.");
                }

                // 1. Save to Firestore (with 15s timeout race)
                console.log("Starting Firestore write...");
                const firestorePromise = window.setDoc(window.doc(window.db, "users", uid), data, { merge: true });
                const timeoutPromise = new Promise((_, reject) => setTimeout(() => reject(new Error("Database timeout (15s)")), 15000));

                await Promise.race([firestorePromise, timeoutPromise]);
                console.log("âœ… Firestore Write Success!");

                // 2. Update localStorage
                const localAuth = JSON.parse(localStorage.getItem('localbridge_auth') || '{}');
                localAuth.name = data.name;
                localAuth.avatarUrl = data.profilePic;
                localStorage.setItem('localbridge_auth', JSON.stringify(localAuth));
                localStorage.setItem('localbridge_display_name', data.name);
                if (data.apiKeys) localStorage.setItem('localbridge_api_keys', JSON.stringify(data.apiKeys));

                // 3. Update Global userState
                if (typeof window.userState !== 'undefined') {
                    window.userState.name = data.name;
                    window.userState.avatarUrl = data.profilePic;
                    if (data.bio) window.userState.bio = data.bio;
                }

                // 4. Update UI
                if (typeof window.updateProfileUI === 'function') window.updateProfileUI();

                return { success: true };
            } catch (err) {
                console.error("âŒ Cloud Sync Error:", err);
                return { success: false, error: err.message };
            }
        };

        window.handleProfilePicSelect = async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const uid = window.getAuthUid();
            if (!uid) return showToast("Not authenticated", "error");

            // 1. Show local preview immediately
            const preview = document.getElementById('set-store-pic-preview');
            const reader = new FileReader();
            reader.onload = (e) => {
                if (preview) preview.src = e.target.result;
            };
            reader.readAsDataURL(file);

            // 2. Upload to Firebase Storage
            showToast("Uploading picture...", "info");
            window.isUploadingPic = true;
            const storageRef = ref(storage, `profile_pics/${uid}/${Date.now()}_${file.name}`);
            const uploadTask = uploadBytesResumable(storageRef, file);

            uploadTask.on('state_changed',
                (snapshot) => {
                    // Progress can be handled here if needed
                },
                (error) => {
                    console.error("Upload error:", error);
                    showToast("Error uploading image", "error");
                    window.isUploadingPic = false;
                },
                async () => {
                    const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                    console.log("Upload Success! URL:", downloadURL);

                    if (document.getElementById('set-store-pic')) document.getElementById('set-store-pic').value = downloadURL;
                    if (document.getElementById('profile-img-input')) document.getElementById('profile-img-input').value = downloadURL;

                    window.isUploadingPic = false;
                    showToast("Picture uploaded! Don't forget to Save Changes.", "success");

                    // Update previews
                    if (preview) preview.src = downloadURL;
                    const largePreview = document.getElementById('profile-img-preview');
                    if (largePreview) {
                        largePreview.src = downloadURL;
                        largePreview.classList.remove('opacity-0');
                    }
                    if (document.getElementById('profile-initials-large')) {
                        document.getElementById('profile-initials-large').classList.add('hidden');
                    }
                }
            );
        };

        window.loadMerchantProfile = async () => {
            const uid = window.getAuthUid();
            if (!uid) return;

            try {
                const docSnap = await getDoc(doc(db, "users", uid));
                if (docSnap.exists()) {
                    const data = docSnap.data();

                    // Populate Settings UI
                    if (document.getElementById('set-store-name')) document.getElementById('set-store-name').value = data.name || 'Sukhdev Electronics';
                    if (document.getElementById('set-store-phone')) document.getElementById('set-store-phone').value = data.phone || '98765 43210';
                    if (document.getElementById('set-store-address')) document.getElementById('set-store-address').value = data.address || 'Shop No. 42, Sector 17, Chandigarh';
                    if (document.getElementById('set-store-bio')) document.getElementById('set-store-bio').value = data.bio || 'Full stack electronics shop';
                    if (document.getElementById('set-store-pic')) document.getElementById('set-store-pic').value = data.profilePic || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200';
                    if (document.getElementById('set-store-pic-preview')) document.getElementById('set-store-pic-preview').src = data.profilePic || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200';

                    // Populate API Keys
                    let keys = data.apiKeys;
                    if (!keys) {
                        const legacy = localStorage.getItem('localbridge_api_keys');
                        if (legacy) {
                            try { keys = JSON.parse(legacy); } catch (e) { }
                        }
                    }

                    if (keys) {
                        if (document.getElementById('api-emailjs-service')) document.getElementById('api-emailjs-service').value = keys.emailjs?.service || '';
                        if (document.getElementById('api-emailjs-template')) document.getElementById('api-emailjs-template').value = keys.emailjs?.template || '';
                        if (document.getElementById('api-emailjs-public')) document.getElementById('api-emailjs-public').value = keys.emailjs?.public || '';
                        if (document.getElementById('api-wa-instance')) document.getElementById('api-wa-instance').value = keys.whatsapp?.instance || '';
                        if (document.getElementById('api-wa-token')) document.getElementById('api-wa-token').value = keys.whatsapp?.token || '';

                        // Set in localStorage for legacy parts of the app
                        localStorage.setItem('localbridge_api_keys', JSON.stringify(keys));
                        if (keys.emailjs?.public) emailjs.init(keys.emailjs.public);
                    }

                    // Update Global State
                    if (data.name) {
                        localStorage.setItem('localbridge_display_name', data.name);
                        const localAuth = JSON.parse(localStorage.getItem('localbridge_auth') || '{}');
                        localAuth.name = data.name;
                        localStorage.setItem('localbridge_auth', JSON.stringify(localAuth));

                        if (typeof window.userState !== 'undefined') {
                            window.userState.name = data.name;
                            window.userState.avatarUrl = data.profilePic;
                        }
                        if (typeof window.updateProfileUI === 'function') window.updateProfileUI();
                    }
                } else {
                    // Scenario: No cloud profile yet, check localStorage to populate UI
                    const legacy = localStorage.getItem('localbridge_api_keys');
                    if (legacy) {
                        try {
                            const keys = JSON.parse(legacy);
                            if (document.getElementById('api-emailjs-service')) document.getElementById('api-emailjs-service').value = keys.emailjs?.service || '';
                            if (document.getElementById('api-emailjs-template')) document.getElementById('api-emailjs-template').value = keys.emailjs?.template || '';
                            if (document.getElementById('api-emailjs-public')) document.getElementById('api-emailjs-public').value = keys.emailjs?.public || '';
                            if (document.getElementById('api-wa-instance')) document.getElementById('api-wa-instance').value = keys.whatsapp?.instance || '';
                            if (document.getElementById('api-wa-token')) document.getElementById('api-wa-token').value = keys.whatsapp?.token || '';
                        } catch (e) { }
                    }
                }
            } catch (err) {
                console.error("Profile Load Error:", err);
            }
        };

        window.addEventListener('load', () => {
            // Check for local keys as fallback
            const savedKeys = localStorage.getItem('localbridge_api_keys');
            if (savedKeys) {
                const keys = JSON.parse(savedKeys);
                if (keys.emailjs?.public) emailjs.init(keys.emailjs.public);
            }
        });


        function updateBroadcastReach() {
            const audience = document.getElementById('broadcast-audience').value;
            const reachDisplay = document.getElementById('broadcast-reach');

            let count = "4,200 users";
            if (audience === 'vip') count = "850 users";
            if (audience === 'inactive') count = "1,200 users";


            reachDisplay.style.opacity = '0.5';
            setTimeout(() => {
                reachDisplay.innerText = count;
                reachDisplay.style.opacity = '1';
            }, 200);
        }

        function sendBroadcast() {
            const message = document.getElementById('broadcast-message').value;
            if (!message) {
                alert("Please enter a message to send.");
                return;
            }

            const btn = event.currentTarget;
            const originalContent = btn.innerHTML;

            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            btn.disabled = true;

            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-check"></i> Blast Sent!';
                btn.classList.remove('bg-slate-900', 'dark:bg-blue-600');
                btn.classList.add('bg-green-600');

                setTimeout(() => {
                    btn.innerHTML = originalContent;
                    btn.classList.add('bg-slate-900', 'dark:bg-blue-600');
                    btn.classList.remove('bg-green-600');
                    btn.disabled = false;
                    document.getElementById('broadcast-message').value = '';
                    alert("Broadcast sent successfully to selected audience!");
                }, 2000);
            }, 1500);
        }

        function handleFileSelect(event) {
            simulateScan();
        }

        function handleDrop(event) {
            event.preventDefault();
            document.getElementById('drop-zone').classList.remove('border-brand-blue', 'bg-blue-50');
            simulateScan();
        }

        function simulateScan() {
            const idleState = document.getElementById('scan-idle');
            const processingState = document.getElementById('scan-processing');
            const successState = document.getElementById('scan-success');

            idleState.classList.add('hidden');
            processingState.classList.remove('hidden');


            setTimeout(() => {
                processingState.classList.add('hidden');
                successState.classList.remove('hidden');


                setTimeout(() => {
                    successState.classList.add('hidden');
                    idleState.classList.remove('hidden');
                    alert("Demo: Receipt data would be saved to your vault!");
                }, 3000);
            }, 2500);
        }

        // --- Profile Management ---
        window.userState = {
            name: "Harsh Gupta",
            email: "harsh@localbridge.com",
            bio: "I am a retail business owner focused on high-end electronics and fashion. LocalBridge helps me manage my inventory seamlessly.",
            avatarUrl: "" // Empty string = use initials
        };

        window.getInitials = function (name) {
            if (!name || name.trim() === "") return "?";
            const parts = name.trim().split(/\s+/);
            if (parts.length === 1) return parts[0].substring(0, 2).toUpperCase();
            return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
        };

        window.updateProfileUI = function () {
            if (typeof window.userState === 'undefined') return;
            const initials = window.getInitials(window.userState.name);

            // Update Navbar Avatar
            const navInitials = document.getElementById('nav-avatar-initials');
            const navImg = document.getElementById('nav-avatar-img');

            if (window.userState.avatarUrl && window.userState.avatarUrl.startsWith('http')) {
                if (navImg) {
                    navImg.src = window.userState.avatarUrl;
                    navImg.classList.remove('hidden');
                }
                if (navInitials) navInitials.classList.add('hidden');
            } else {
                if (navInitials) {
                    navInitials.innerText = initials;
                    navInitials.classList.remove('hidden');
                }
                if (navImg) navImg.classList.add('hidden');
            }

            // Update Dropdown Content
            const dropdownImg = document.getElementById('dropdown-avatar-img');
            if (dropdownImg) {
                dropdownImg.src = (window.userState.avatarUrl && window.userState.avatarUrl.startsWith('http'))
                    ? window.userState.avatarUrl
                    : `https://ui-avatars.com/api/?name=${encodeURIComponent(window.userState.name)}&background=random`;
            }
            const dropdownName = document.getElementById('dropdown-user-name');
            if (dropdownName) dropdownName.innerText = window.userState.name;
            const dropdownEmail = document.getElementById('dropdown-user-email');
            if (dropdownEmail) dropdownEmail.innerText = window.userState.email;

            // Sync Sidebar Avatar
            const sideInitials = document.getElementById('sidebar-avatar-initials');
            const sideImg = document.getElementById('sidebar-avatar-img');
            if (window.userState.avatarUrl && window.userState.avatarUrl.startsWith('http')) {
                if (sideImg) {
                    sideImg.src = window.userState.avatarUrl;
                    sideImg.classList.remove('hidden');
                }
                if (sideInitials) sideInitials.classList.add('hidden');
            } else {
                if (sideInitials) {
                    sideInitials.innerText = initials;
                    sideInitials.classList.remove('hidden');
                }
                if (sideImg) {
                    sideImg.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(window.userState.name || 'Shop')}&background=random`;
                    sideImg.classList.remove('hidden');
                    // Alternatively, hide img if initials are shown:
                    // sideImg.classList.add('hidden');
                }
            }

            // Update Sidebar Store Name
            const sidebarStoreName = document.getElementById('sidebar-store-name');
            if (sidebarStoreName) sidebarStoreName.innerText = window.userState.name;

            // Update Profile View Preview
            const largeInitials = document.getElementById('profile-initials-large');
            const largeImg = document.getElementById('profile-img-preview');

            if (largeInitials) largeInitials.innerText = initials;

            if (window.userState.avatarUrl && window.userState.avatarUrl.startsWith('http')) {
                if (largeImg) {
                    largeImg.src = window.userState.avatarUrl;
                    largeImg.classList.remove('opacity-0');
                }
            } else {
                if (largeImg) largeImg.classList.add('opacity-0');
            }

            // Update input fields
            const nameInput = document.getElementById('profile-name-input');
            if (nameInput) nameInput.value = window.userState.name;
            const emailInput = document.getElementById('profile-email-input');
            if (emailInput) emailInput.value = window.userState.email;
            const imgInput = document.getElementById('profile-img-input');
            if (imgInput) imgInput.value = window.userState.avatarUrl;
            const bioInput = document.getElementById('profile-bio-input');
            if (bioInput) bioInput.value = window.userState.bio;
        };

        window.saveProfile = async function () {
            const btn = document.getElementById('profile-save-btn');
            const originalText = btn.innerText;

            const newName = document.getElementById('profile-name-input').value;
            const newEmail = document.getElementById('profile-email-input').value;
            const newUrl = document.getElementById('profile-img-input').value;
            const newBio = document.getElementById('profile-bio-input').value;

            if (window.isUploadingPic) {
                return showToast("Please wait for the image to finish uploading...", "info");
            }

            btn.innerText = "Saving to Cloud...";
            btn.disabled = true;

            const uid = window.getAuthUid();
            if (!uid) {
                showToast("Not authenticated. Please login again.", "error");
                btn.disabled = false;
                btn.innerText = originalText;
                return;
            }

            // Sync with Merchant Settings fields if they exist
            const profileData = {
                name: newName,
                bio: newBio,
                profilePic: newUrl,
                updatedAt: serverTimestamp()
            };

            try {
                const result = await window.syncProfileToCloud(uid, profileData);
                if (result.success) {
                    btn.innerText = "Profile Saved!";
                    btn.classList.add('bg-green-600');
                    showToast("Profile Saved to Cloud!", "success");
                } else {
                    throw new Error(result.error);
                }
            } catch (err) {
                console.error("Profile Save Error:", err);
                showToast("Error: " + err.message, "error");
            } finally {
                btn.disabled = false;
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.classList.remove('bg-green-600');
                }, 2000);
            }
        };

        // Live preview for name/initials
        document.getElementById('profile-name-input').addEventListener('input', (e) => {
            const initials = getInitials(e.target.value);
            document.getElementById('profile-initials-large').innerText = initials;
            // Also update nav initials immediately for wow factor
            if (!userState.avatarUrl) {
                document.getElementById('nav-avatar-initials').innerText = initials;
            }
        });

        // Live preview for profile picture URL
        document.getElementById('profile-img-input').addEventListener('input', (e) => {
            const url = e.target.value.trim();
            const preview = document.getElementById('profile-img-preview');
            if (url && url.startsWith('http')) {
                preview.src = url;
                preview.classList.remove('opacity-0');
            } else {
                preview.classList.add('opacity-0');
            }
        });

        // Initialize UI with default state
        updateProfileUI();

        // Campaign Management Logic
        let campaignsSyncActive = false;
        window.initCampaignSync = () => {
            if (campaignsSyncActive) return;
            const uid = window.getAuthUid();
            if (!uid) return;
            campaignsSyncActive = true;

            onSnapshot(query(collection(db, "campaigns"), where("merchantId", "==", uid)), (snap) => {
                const list = document.getElementById('merchant-campaigns-list');
                if (!list) return;
                list.innerHTML = '';

                if (snap.empty) {
                    list.innerHTML = `
                        <div class="col-span-full py-12 text-center text-slate-400">
                            <i class="fas fa-bullhorn text-4xl mb-4 opacity-20"></i>
                            <p>You haven't launched any campaigns yet.</p>
                        </div>
                    `;
                    return;
                }

                snap.forEach(docSnap => {
                    const data = docSnap.data();
                    const card = document.createElement('div');
                    card.className = "bg-white dark:bg-slate-800 p-6 rounded-2xl border border-gray-200 dark:border-slate-700 shadow-sm animate-fade-in";

                    const expiresAt = data.expiresAt ? data.expiresAt.toDate() : new Date();
                    const timeLeft = Math.ceil((expiresAt - new Date()) / (1000 * 60 * 60 * 24));

                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <span class="px-3 py-1 bg-green-100 text-green-700 text-[10px] font-bold uppercase rounded-full">Active</span>
                            <span class="text-xs text-slate-400">${timeLeft > 0 ? 'Ends in ' + timeLeft + ' days' : 'Expired'}</span>
                        </div>
                        <h3 class="font-bold text-slate-900 dark:text-white mb-2">${data.title}</h3>
                        <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">${data.description}</p>
                        <div class="flex items-center justify-between text-xs font-bold text-slate-400 border-t pt-4">
                            <span class="text-blue-600 uppercase tracking-widest">${data.discount}</span>
                            <button onclick="deleteCampaign('${docSnap.id}')" class="text-red-400 hover:text-red-600 transition p-2">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    `;
                    list.appendChild(card);
                });
            }, (error) => {
                console.error("Campaign Sync Error:", error);
            });
        };

        window.deleteCampaign = async (id) => {
            if (!confirm("Are you sure you want to delete this campaign? It will be removed from all customers as well.")) return;
            try {
                await deleteDoc(doc(db, "campaigns", id));
                showToast("Campaign deleted successfully", "success");
            } catch (err) {
                showToast("Error deleting campaign", "error");
            }
        };

        let customerOffersSyncActive = false;
        window.initCustomerOffersSync = () => {
            if (customerOffersSyncActive) return;
            customerOffersSyncActive = true;
            console.log("initCustomerOffersSync: Starting listener");

            const section = document.getElementById('customer-offers-section');
            const list = document.getElementById('customer-offers-list');

            onSnapshot(query(collection(db, "campaigns"), where("status", "==", "active")), (snap) => {
                console.log("initCustomerOffersSync: Received snapshot, size:", snap.size);
                if (!list || !section) return;
                list.innerHTML = '';

                if (snap.empty) {
                    console.log("initCustomerOffersSync: No active campaigns found");
                    section.classList.add('hidden');
                    return;
                }

                section.classList.remove('hidden');
                setTimeout(() => section.classList.add('revealed'), 100);

                // Sort in memory
                const docs = [];
                snap.forEach(d => docs.push({ id: d.id, ...d.data() }));
                docs.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));

                docs.forEach(data => {
                    const card = document.createElement('div');
                    card.className = "bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-100 dark:border-slate-700 shadow-lg relative overflow-hidden group hover:scale-[1.02] transition-all duration-300 flex flex-col h-full";

                    card.innerHTML = `
                        <div class="absolute top-0 right-0 w-24 h-24 bg-blue-500/5 rounded-full blur-2xl -translate-y-1/2 translate-x-1/2 group-hover:bg-blue-500/10 transition"></div>
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 rounded-xl bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center text-brand-blue">
                                <i class="fas fa-store"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-900 dark:text-white text-sm">${data.merchantName || 'Local Merchant'}</h4>
                                <p class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Verified Partner</p>
                            </div>
                        </div>
                        <h3 class="font-display font-bold text-lg text-slate-900 dark:text-white mb-2">${data.title}</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400 mb-6 leading-relaxed">${data.description}</p>
                        <div class="flex items-center justify-between mt-auto pt-4 border-t border-slate-50 dark:border-slate-700/50">
                            <span class="text-xl font-black text-brand-blue">${data.discount}</span>
                            <button onclick="showToast('Offer saved to your profile!', 'success')" class="px-4 py-2 bg-brand-blue text-white rounded-xl text-[10px] font-bold uppercase tracking-widest hover:bg-blue-600 transition-all shadow-md shadow-blue-500/20 active:scale-95">Claim Offer</button>
                        </div>
                    `;
                    list.appendChild(card);
                });
            }, (error) => {
                console.error("Customer Offers Sync Error:", error);
            });
        };
    </script>
    <!-- Modals for 'My Files' -->
    <div id="my-files-modals-container">
        <!-- New Folder Modal -->
        <div id="modal-new-folder"
            class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-fade-in">
            <div
                class="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-zoom-in">
                <div class="flex justify-between items-center p-6 border-b border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-slate-900 dark:text-white">New Folder</h3>
                    <button onclick="toggleModal('modal-new-folder', false)"
                        class="text-slate-400 hover:text-slate-600 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form onsubmit="handleNewFolderSubmit(event)" class="p-6 space-y-4">
                    <div>
                        <label
                            class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Folder
                            Name</label>
                        <input type="text" id="input-folder-name" required
                            class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 outline-none focus:border-brand-blue transition"
                            placeholder="e.g. Invoices 2024">
                    </div>
                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="toggleModal('modal-new-folder', false)"
                            class="flex-1 px-4 py-3 border border-slate-200 dark:border-slate-700 rounded-xl font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition">Cancel</button>
                        <button type="submit" id="btn-create-folder"
                            class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition">Create
                            Folder</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add File Modal (Upload) -->
        <div id="modal-add-file"
            class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-fade-in">
            <div
                class="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-zoom-in">
                <div class="flex justify-between items-center p-6 border-b border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-slate-900 dark:text-white">Upload File</h3>
                    <button onclick="toggleModal('modal-add-file', false)"
                        class="text-slate-400 hover:text-slate-600 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form onsubmit="handleNewFileSubmit(event)" class="p-6 space-y-4">
                    <!-- File Picker Dropzone -->
                    <div>
                        <label
                            class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Choose
                            File</label>
                        <div onclick="document.getElementById('input-file-upload').click()"
                            class="w-full p-8 rounded-xl border-2 border-dashed border-slate-200 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-600 transition cursor-pointer bg-slate-50 dark:bg-slate-900 text-center">
                            <i class="fas fa-cloud-upload-alt text-3xl text-blue-400 mb-2"></i>
                            <p id="file-drop-label" class="text-sm font-medium text-slate-500">Click to choose a file
                            </p>
                            <p class="text-[10px] text-slate-400 mt-1">Max 50 MB</p>
                        </div>
                        <input type="file" id="input-file-upload" class="hidden"
                            onchange="(function(el){ var label = document.getElementById('file-drop-label'); if(el.files[0] && label) label.textContent = el.files[0].name; })(this)">
                    </div>
                    <!-- Folder Selector -->
                    <div>
                        <label
                            class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Target
                            Folder</label>
                        <select id="select-file-folder"
                            class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 outline-none focus:border-brand-blue transition font-bold text-slate-600 dark:text-slate-300">
                            <option value="">No Folder (Root)</option>
                        </select>
                    </div>
                    <!-- Upload Progress -->
                    <div id="upload-progress-container" class="hidden">
                        <div class="flex justify-between items-center mb-1">
                            <span
                                class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Uploading</span>
                            <span id="upload-progress-text" class="text-xs font-bold text-blue-600">0%</span>
                        </div>
                        <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-full h-2 overflow-hidden">
                            <div id="upload-progress-bar"
                                class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%">
                            </div>
                        </div>
                    </div>
                    <!-- Error Display -->
                    <p id="upload-error"
                        class="hidden text-xs font-bold text-red-500 bg-red-50 dark:bg-red-900/20 p-3 rounded-xl"></p>
                    <!-- Buttons -->
                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="toggleModal('modal-add-file', false)"
                            class="flex-1 px-4 py-3 border border-slate-200 dark:border-slate-700 rounded-xl font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition">Cancel</button>
                        <button type="submit" id="btn-upload-file"
                            class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition flex items-center justify-center gap-2">
                            <i class="fas fa-cloud-upload-alt"></i> Upload File
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- New Note Modal -->
        <div id="modal-new-note"
            class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-fade-in">
            <div
                class="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-zoom-in">
                <div class="flex justify-between items-center p-6 border-b border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-slate-900 dark:text-white">New Quick Note</h3>
                    <button onclick="toggleModal('modal-new-note', false)"
                        class="text-slate-400 hover:text-slate-600 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form onsubmit="handleNewNoteSubmit(event)" class="p-6 space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Note
                            Title</label>
                        <input type="text" id="input-note-title" required
                            class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 outline-none focus:border-brand-blue transition"
                            placeholder="e.g. Supplier Contact">
                    </div>
                    <div>
                        <label
                            class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Content</label>
                        <textarea id="input-note-content"
                            class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 outline-none focus:border-brand-blue transition resize-none h-32"
                            placeholder="Type your note here..."></textarea>
                    </div>
                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="toggleModal('modal-new-note', false)"
                            class="flex-1 px-4 py-3 border border-slate-200 dark:border-slate-700 rounded-xl font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition">Cancel</button>
                        <button type="submit" id="btn-save-note"
                            class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition">Save
                            Note</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Member Modal -->
        <div id="modal-add-member"
            class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-fade-in">
            <div
                class="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-zoom-in">
                <div class="flex justify-between items-center p-6 border-b border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-slate-900 dark:text-white">Add Team Member</h3>
                    <button onclick="toggleModal('modal-add-member', false)"
                        class="text-slate-400 hover:text-slate-600 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form onsubmit="handleNewMemberSubmit(event)" class="p-6 space-y-4">
                    <div>
                        <label
                            class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Name</label>
                        <input type="text" id="input-member-name" required
                            class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 outline-none focus:border-brand-blue transition"
                            placeholder="e.g. John Doe">
                    </div>
                    <div>
                        <label
                            class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Role</label>
                        <input type="text" id="input-member-role"
                            class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 outline-none focus:border-brand-blue transition"
                            placeholder="e.g. Sales Manager">
                    </div>
                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="toggleModal('modal-add-member', false)"
                            class="flex-1 px-4 py-3 border border-slate-200 dark:border-slate-700 rounded-xl font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition">Cancel</button>
                        <button type="submit" id="btn-add-member"
                            class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition">Add
                            Member</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>

</html>